
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Cómo crear una restricción de validación personalizada &mdash; Manual de Symfony2 en Español</title>
    
    <link rel="stylesheet" href="../../_static/tnp.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0.14',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="shortcut icon" href="../../_static/icotnp.ico"/>
    <link rel="top" title="Manual de Symfony2 en Español" href="../../index.html" />
    <link rel="up" title="Validando" href="index.html" />
    <link rel="next" title="Configurando" href="../configuration/index.html" />
    <link rel="prev" title="Validando" href="index.html" /> 
  </head>
  <body>
  <div class="imalogo">
    
  <a href="../../index.html"><img src="http://gitnacho.github.com/tnp/img/sf/logo-big.gif" alt="Edición estándar de Symfony2" />
  
    <a href="http://gitnacho.github.com/tnp/"><img src="http://gitnacho.github.com/tnp/_static/normaltnp.png" alt="Traducciones de Nacho Pacheco" /></a>
    <div class="social">
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="esymfony" data-lang="es">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
    <div id="searchbox">
      <form class="searc " action="../../search.html" method="get">
      <input type="search" name="q" placeholder="Término a buscar" />
      <input type="submit" value="Ir" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
    

    
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../configuration/index.html" title="Configurando"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="index.html" title="Validando"
             accesskey="P">anterior</a> |</li>
        <li><a href="../../index.html">en Español</a> &raquo;</li>
          <li><a href="../index.html" >Recetario</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Validando</a> &raquo;</li> 
      </ul>
    </div>
  </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="como-crear-una-restriccion-de-validacion-personalizada">
<span id="index-0"></span><h1>Cómo crear una restricción de validación personalizada<a class="headerlink" href="#como-crear-una-restriccion-de-validacion-personalizada" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Puedes crear una restricción personalizada extendiendo la clase base &#8220;constraint&#8221;, <tt class="xref php php-class docutils literal"><span class="pre">Symfony\Component\Validator\Constraint</span></tt>. Las opciones para tu restricción se representan como propiedades públicas de la clase <tt class="docutils literal"><span class="pre">constraint</span></tt>. Por ejemplo, la restricción <a class="reference internal" href="../../reference/constraints/Url.html"><em>URL</em></a> incluye las propiedades <tt class="docutils literal"><span class="pre">message</span></tt> y <tt class="docutils literal"><span class="pre">protocols</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Symfony\Component\Validator\Constraints</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraint</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @Annotation</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Protocol</span> <span class="k">extends</span> <span class="nx">Constraint</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;This value is not a valid protocol&#39;</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$protocols</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="s1">&#39;ftp&#39;</span><span class="p">,</span> <span class="s1">&#39;ftps&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">La anotación <tt class="docutils literal"><span class="pre">&#64;Annotation</span></tt> es necesaria para esta nueva restricción con el fin de hacerla disponible para su uso en clases vía anotaciones.</p>
</div>
<p>Como puedes ver, una clase de restricción es bastante mínima. La validación real la lleva a cabo otra clase &#8220;validadora de restricción&#8221;. La clase validadora de restricción se especifica con el método <tt class="docutils literal"><span class="pre">validatedBy()</span></tt> de la restricción, el cual por omisión incluye alguna lógica simple:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// en la clase base Symfony\Component\Validator\Constraint</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">validatedBy</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$this</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;Validator&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>En otras palabras, si creas una <tt class="docutils literal"><span class="pre">restricción</span></tt> personalizada (por ejemplo, <tt class="docutils literal"><span class="pre">MyConstraint</span></tt>), cuando <em>Symfony2</em> realmente lleve a cabo la validación automáticamente buscará otra clase, <tt class="docutils literal"><span class="pre">MyConstraintValidator</span></tt>.</p>
<p>La clase <tt class="docutils literal"><span class="pre">validator</span></tt> también es simple, y sólo tiene un método obligatorio: <tt class="docutils literal"><span class="pre">validate</span></tt>.
Además de nuestro ejemplo, échale un vistazo al <tt class="docutils literal"><span class="pre">ProtocolValidator</span></tt> como ejemplo:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">namespace</span> <span class="nx">Symfony\Component\Validator\Constraints</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\ConstraintValidator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProtocolValidator</span> <span class="k">extends</span> <span class="nx">ConstraintValidator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validate</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nx">Constraint</span> <span class="nv">$constraint</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$constraint</span><span class="o">-&gt;</span><span class="na">protocols</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">context</span><span class="o">-&gt;</span><span class="na">addViolation</span><span class="p">(</span><span class="nv">$constraint</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;%protocols%&#39;</span> <span class="o">=&gt;</span> <span class="nv">$constraint</span><span class="o">-&gt;</span><span class="na">protocols</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">El método <tt class="docutils literal"><span class="pre">validate</span></tt> no devuelve un valor; en cambio, añade violaciones al validador de la propiedad <tt class="docutils literal"><span class="pre">context</span></tt> con una llamada al método <tt class="docutils literal"><span class="pre">addViolation</span></tt> si hay errores de validación. Por lo tanto, un valor se podría considerar como válido si no provoca que se añadan violaciones al contexto.
El primer parámetro de la llamada a <tt class="docutils literal"><span class="pre">addViolation</span></tt> es el mensaje de error a utilizar para esa violación.</p>
</div>
<p class="versionadded">
<span class="versionmodified">Nuevo en la versión 2.1.</span></p>
<div class="section" id="restriccion-de-validadores-con-dependencias">
<h2>Restricción de validadores con dependencias<a class="headerlink" href="#restriccion-de-validadores-con-dependencias" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Si la restricción del validador tiene dependencias, tal como una conexión de base de datos, se tendrá que configurar como un servicio en el contenedor de inyección de dependencias. Este servicio debe incluir la etiqueta <tt class="docutils literal"><span class="pre">validator.constraint_validator</span></tt> y un atributo <tt class="docutils literal"><span class="pre">alias</span></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">validator.unique.your_validator_name</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Nombre\De\Clase\Validator\Completamente\Cualificado</span>
        <span class="l-Scalar-Plain">tags</span><span class="p-Indicator">:</span>
                <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">validator.constraint_validator</span><span class="p-Indicator">,</span> <span class="nv">alias</span><span class="p-Indicator">:</span> <span class="nv">alias_name</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;validator.unique.your_validator_name&quot;</span> <span class="na">class=</span><span class="s">&quot;Nombre\De\Clase\Validator\Completamente\Cualificado&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;argument</span> <span class="na">type=</span><span class="s">&quot;service&quot;</span> <span class="na">id=</span><span class="s">&quot;doctrine.orm.default_entity_manager&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;validator.constraint_validator&quot;</span> <span class="na">alias=</span><span class="s">&quot;alias_name&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="nv">$container</span>
    <span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="s1">&#39;validator.unique.your_validator_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Nombre\De\Clase\Validator\Completamente\Cualificado&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">addTag</span><span class="p">(</span><span class="s1">&#39;validator.constraint_validator&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;alias&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alias_name&#39;</span><span class="p">))</span>
<span class="p">;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Tu clase restricción ahora debe usar este alias para hacer referencia al validador adecuado:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">validatedBy</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;alias_name&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Como mencionamos anteriormente, <em>Symfony2</em> buscará automáticamente una clase llamada <tt class="docutils literal"><span class="pre">after</span></tt> después de la restricción, con su <tt class="docutils literal"><span class="pre">Validador</span></tt> adjunto.  Si tu restricción de validación está definida como un servicio, es importante que redefinas el método <tt class="docutils literal"><span class="pre">validatedBy()</span></tt> para que devuelva el alias utilizado cuando definiste tu servicio, de lo contrario <em>Symfony2</em> no utilizará el servicio de la restricción de validación, y, en su lugar, creará una instancia de la clase, sin inyectar ningún tipo de dependencia.</p>
</div>
<div class="section" id="clase-para-la-validacion-de-restriccion">
<h2>Clase para la validación de restricción<a class="headerlink" href="#clase-para-la-validacion-de-restriccion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Además de validar una propiedad de clase, una restricción puede tener un ámbito de clase proporcionándole un objetivo:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">getTargets</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">CLASS_CONSTRAINT</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Con esto, el método validador <tt class="docutils literal"><span class="pre">validate()</span></tt> obtiene un objeto como primer argumento:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ProtocolClassValidator</span> <span class="k">extends</span> <span class="nx">ConstraintValidator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">validate</span><span class="p">(</span><span class="nv">$protocol</span><span class="p">,</span> <span class="nx">Constraint</span> <span class="nv">$constraint</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$protocol</span><span class="o">-&gt;</span><span class="na">getFoo</span><span class="p">()</span> <span class="o">!=</span> <span class="nv">$protocol</span><span class="o">-&gt;</span><span class="na">getBar</span><span class="p">())</span> <span class="p">{</span>

            <span class="c1">// vincula el mensaje de error a la propiedad foo</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">context</span><span class="o">-&gt;</span><span class="na">addViolationAtSubPath</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">$constraint</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span> <span class="k">array</span><span class="p">(),</span> <span class="k">null</span><span class="p">);</span>

                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <a href="https://github.com/symfony/symfony-standard"><img style="position: fixed; top: 0; right: 0; border: 0;" src="http://gitnacho.github.com/tnp/img/comun/bifurcame.png" alt="Bifúrcame en GitHub" /></a>
  
  <div style="width:740px;margin:10px auto;">
    
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../configuration/index.html" title="Configurando"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="index.html" title="Validando"
             >anterior</a> |</li>
        <li><a href="../../index.html">en Español</a> &raquo;</li>
          <li><a href="../index.html" >Recetario</a> &raquo;</li>
          <li><a href="index.html" >Validando</a> &raquo;</li> 
      </ul>
    </div>
  </div>


   <div style="width: 740px; margin: 0 auto;">
     <div id="disqus_thread"></div>
     
    <div class="footer">
        &copy; Copyright 2011-2012, Traducido por Nacho Pacheco.
      Actualizado por última vez en May 21, 2012.
      Creado con <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
   </div>
   <script type="text/javascript">
    var disqus_shortname = 'documentos-mx';
    var disqus_developer = 1;
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
   </script>
   <noscript>
     Por favor activa JavaScript para ver los <a href="http://disqus.com/?ref_noscript">comentarios accionados por Disqus.</a>
   </noscript>

  </body>
</html>