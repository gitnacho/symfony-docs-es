
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Probando &mdash; Manual de Symfony2 en Español</title>
    
    <link rel="stylesheet" href="../_static/tnp.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.15',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/icotnp.ico"/>
    <link rel="top" title="Manual de Symfony2 en Español" href="../index.html" />
    <link rel="up" title="Libro" href="index.html" />
    <link rel="next" title="Validando" href="validation.html" />
    <link rel="prev" title="Bases de datos y Doctrine (“El modelo”)" href="doctrine.html" /> 
  </head>
  <body>
  <div class="imalogo">
    
  <a href="../index.html"><img src="http://gitnacho.github.com/tnp/img/sf/logo-big.gif" alt="Edición estándar de Symfony2" />
  
    <a href="http://gitnacho.github.com/tnp/"><img src="http://gitnacho.github.com/tnp/_static/normaltnp.png" alt="Traducciones de Nacho Pacheco" /></a>
    <div class="social">
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="esymfony" data-lang="es">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
    <div id="searchbox">
      <form class="searc " action="../search.html" method="get">
      <input type="search" name="q" placeholder="Término a buscar" />
      <input type="submit" value="Ir" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
    

    
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="validation.html" title="Validando"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="doctrine.html" title="Bases de datos y Doctrine (“El modelo”)"
             accesskey="P">anterior</a> |</li>
        <li><a href="../index.html">en Español</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Libro</a> &raquo;</li> 
      </ul>
    </div>
  </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="probando">
<span id="index-0"></span><h1>Probando<a class="headerlink" href="#probando" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Cada vez que escribes una nueva línea de código, potencialmente, añades nuevos errores también.
Para construir mejores y más confiables aplicaciones, debes probar tu código usando ambas pruebas, unitarias y funcionales.</p>
<div class="section" id="la-plataforma-de-pruebas-phpunit">
<h2>La plataforma de pruebas <em>PHPUnit</em><a class="headerlink" href="#la-plataforma-de-pruebas-phpunit" title="Enlazar permanentemente con este título">¶</a></h2>
<p><em>Symfony2</em> integra una biblioteca independiente &#8212;llamada <em>PHPUnit</em>&#8212; para proporcionarte una rica plataforma de pruebas. Esta parte no cubre <em>PHPUnit</em> en sí mismo, puesto que la biblioteca cuenta con su propia y excelente <a class="reference external" href="http://www.phpunit.de/manual/3.5/en/">documentación</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last"><em>Symfony2</em> trabaja con <em>PHPUnit</em> 3.5.11 o más reciente.</p>
</div>
<p>Cada prueba &#8212;si se trata de una prueba unitaria o una prueba funcional&#8212; es una clase <em>PHP</em> que debe vivir en el subdirectorio <tt class="docutils literal"><span class="pre">Tests/</span></tt> de tus paquetes. Si sigues esta regla, entonces puedes ejecutar todas las pruebas de tu aplicación con la siguiente orden:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># especifica la configuración del directorio en la línea de ordenes</span>
<span class="nv">$ </span>phpunit -c app/
</pre></div>
</div>
<p>La opción <tt class="docutils literal"><span class="pre">-c</span></tt> le dice a <em>PHPUnit</em> que busque el archivo de configuración en el directorio <tt class="docutils literal"><span class="pre">app/</span></tt>. Si tienes curiosidad sobre qué significan las opciones de <em>PHPUnit</em>, dale un vistazo al archivo <tt class="docutils literal"><span class="pre">app/phpunit.xml.dist</span></tt>.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">La cobertura de código se puede generar con la opción <tt class="docutils literal"><span class="pre">--coverage-html</span></tt>.</p>
</div>
</div>
<div class="section" id="pruebas-unitarias">
<span id="index-1"></span><h2>Pruebas unitarias<a class="headerlink" href="#pruebas-unitarias" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Una prueba unitaria normalmente es una prueba contra una clase <em>PHP</em> específica. Si deseas probar el comportamiento de tu aplicación en conjunto, ve la sección sobre las <a class="reference internal" href="#pruebas-funcionales">Pruebas funcionales</a>.</p>
<p>Escribir pruebas unitarias en <em>Symfony2</em> no es diferente a escribir pruebas unitarias <em>PHPUnit</em> normales. Supongamos, por ejemplo, que tienes una clase <em>increíblemente</em> simple llamada <tt class="docutils literal"><span class="pre">Calculator</span></tt> en el directorio <tt class="docutils literal"><span class="pre">Utility/</span></tt> de tu paquete:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/DemoBundle/Utility/Calculator.php</span>
<span class="k">namespace</span> <span class="nx">Acme\DemoBundle\Utility</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Calculator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Para probarla, crea un archivo <tt class="docutils literal"><span class="pre">CalculatorTest</span></tt> en el directorio <tt class="docutils literal"><span class="pre">Tests/Utility</span></tt> de tu paquete:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/DemoBundle/Tests/Utility/CalculatorTest.php</span>
<span class="k">namespace</span> <span class="nx">Acme\DemoBundle\Tests\Utility</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Acme\DemoBundle\Utility\Calculator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CalculatorTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$calc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Calculator</span><span class="p">();</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$calc</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>

        <span class="c1">// ¡acierta que nuestra calculadora suma dos números correctamente!</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Por convención, el subdirectorio <tt class="docutils literal"><span class="pre">Tests/</span></tt> debería replicar al directorio de tu paquete. Por lo tanto, si estás probando una clase en el directorio <tt class="docutils literal"><span class="pre">Utility/</span></tt> de tu paquete, pon tus pruebas en el directorio <tt class="docutils literal"><span class="pre">Tests/Utility</span></tt>.</p>
</div>
<p>Al igual que en tu aplicación real &#8212;el archivo <tt class="docutils literal"><span class="pre">bootstrap.php.cache</span></tt>&#8212; automáticamente activa el autocargador (como si lo hubieras configurado por omisión en el archivo <tt class="docutils literal"><span class="pre">phpunit.xml.dist</span></tt>).</p>
<p>Correr las pruebas de un determinado archivo o directorio también es muy fácil:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># ejecuta todas las pruebas en el directorio &#39;Utility&#39;</span>
<span class="nv">$ </span>phpunit -c app src/Acme/DemoBundle/Tests/Utility/

<span class="c"># corre las pruebas para la clase Calculator</span>
<span class="nv">$ </span>phpunit -c app src/Acme/DemoBundle/Tests/Utility/CalculatorTest.php

<span class="c"># corre todas las pruebas del paquete entero</span>
<span class="nv">$ </span>phpunit -c app src/Acme/DemoBundle/
</pre></div>
</div>
</div>
<div class="section" id="pruebas-funcionales">
<span id="index-2"></span><h2>Pruebas funcionales<a class="headerlink" href="#pruebas-funcionales" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Las pruebas funcionales verifican la integración de las diferentes capas de una aplicación (desde el enrutado hasta la vista). Ellas no son diferentes de las pruebas unitarias en cuanto a <em>PHPUnit</em> se refiere, pero tienen un flujo de trabajo muy específico:</p>
<ul class="simple">
<li>Envían una petición;</li>
<li>Prueban la respuesta;</li>
<li>Hacen clic en un enlace o envían un formulario;</li>
<li>Prueban la respuesta;</li>
<li>Enjuagan y repiten.</li>
</ul>
<div class="section" id="tu-primera-prueba-funcional">
<h3>Tu primera prueba funcional<a class="headerlink" href="#tu-primera-prueba-funcional" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las pruebas funcionales son simples archivos <em>PHP</em> que suelen vivir en el directorio <tt class="docutils literal"><span class="pre">Tests/Controller</span></tt> de tu paquete. Si deseas probar las páginas a cargo de tu clase <tt class="docutils literal"><span class="pre">DemoController</span></tt>, empieza creando un nuevo archivo <tt class="file docutils literal"><span class="pre">DemoControllerTest.php</span></tt> que extiende una clase <tt class="docutils literal"><span class="pre">WebTestCase</span></tt> especial.</p>
<p>Por ejemplo, la <em>edición estándar de Symfony2</em> proporciona una sencilla prueba funcional para <tt class="docutils literal"><span class="pre">DemoController</span></tt> (<a class="reference external" href="https://github.com/symfony/symfony-standard/blob/master/src/Acme/DemoBundle/Tests/Controller/DemoControllerTest.php">DemoControllerTest</a>) que dice lo siguiente:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/DemoBundle/Tests/Controller/DemoControllerTest.php</span>
<span class="k">namespace</span> <span class="nx">Acme\DemoBundle\Tests\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Test\WebTestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DemoControllerTest</span> <span class="k">extends</span> <span class="nx">WebTestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIndex</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$client</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">createClient</span><span class="p">();</span>

        <span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/demo/hello/Fabien&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;html:contains(&quot;Hello Fabien&quot;)&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p>Para ejecutar tus pruebas funcionales, la clase <tt class="docutils literal"><span class="pre">WebTestCase</span></tt> arranca el núcleo de tu aplicación. En la mayoría de los casos, esto sucede automáticamente.
Sin embargo, si tu núcleo se encuentra en un directorio no estándar, deberás modificar tu archivo <tt class="docutils literal"><span class="pre">phpunit.xml.dist</span></tt> para ajustar la variable de entorno <tt class="docutils literal"><span class="pre">KERNEL_DIR</span></tt> al directorio de tu núcleo:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="o">&lt;</span><span class="nx">phpunit</span>
    <span class="o">&lt;!--</span> <span class="o">...</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="nx">php</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">server</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;KERNEL_DIR&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;/path/to/your/app/&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="nx">php</span><span class="o">&gt;</span>
    <span class="o">&lt;!--</span> <span class="o">...</span> <span class="o">--&gt;</span>
<span class="o">&lt;/</span><span class="nx">phpunit</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p>El método <tt class="docutils literal"><span class="pre">createClient()</span></tt> devuelve un cliente, el cual es como un navegador que debes usar para explorar tu sitio:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/demo/hello/Fabien&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>El método <tt class="docutils literal"><span class="pre">request()</span></tt> (consulta <a class="reference internal" href="#book-testing-request-method-sidebar"><em>más sobre el método request</em></a>) devuelve un objeto <tt class="xref php php-class docutils literal"><span class="pre">Symfony\Component\DomCrawler\Crawler</span></tt> que puedes utilizar para seleccionar elementos en la respuesta, hacer clic en enlaces, y enviar formularios.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">El <tt class="docutils literal"><span class="pre">Crawler</span></tt> únicamente trabaja cuando la respuesta es <em>XML</em> o un documento <em>HTML</em>.
Para conseguir el contenido crudo de la respuesta, llama a <tt class="docutils literal"><span class="pre">$client-&gt;getResponse()-&gt;getContent()</span></tt>.</p>
</div>
<p>Haz clic en un enlace seleccionándolo primero con el <tt class="docutils literal"><span class="pre">Crawler</span></tt> utilizando una expresión <tt class="docutils literal"><span class="pre">XPath</span></tt> o un selector <em>CSS</em>, luego utiliza el cliente para hacer clic en él. Por ejemplo, el siguiente código buscará todos los enlaces con el texto <tt class="docutils literal"><span class="pre">Greet</span></tt>, a continuación, selecciona el segundo, y en última instancia, hace clic en él:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$link</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;a:contains(&quot;Greet&quot;)&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>

<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
</pre></div>
</div>
<p>El envío de un formulario es muy similar; selecciona un botón del formulario, opcionalmente sustituye algunos valores del formulario, y ​​envía el formulario correspondiente:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectButton</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">();</span>

<span class="c1">// sustituye algunos valores</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Lucas&#39;</span><span class="p">;</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;form_name[subject]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Hey there!&#39;</span><span class="p">;</span>

<span class="c1">// envía el formulario</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$form</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">El formulario también puede manejar archivos subidos y contiene métodos para llenar los diferentes tipos de campos del formulario (por ejemplo, <tt class="docutils literal"><span class="pre">select()</span></tt> y <tt class="docutils literal"><span class="pre">tick()</span></tt>). Para más detalles, consulta la sección <a class="reference internal" href="#formularios">Formularios</a> más adelante.</p>
</div>
<p>Ahora que puedes navegar fácilmente a través de una aplicación, utiliza las aserciones para probar que en realidad hace lo que se espera. Utiliza el <tt class="docutils literal"><span class="pre">Crawler</span></tt> para hacer aserciones sobre el <em>DOM</em>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// Afirma que la respuesta concuerda con un determinado selector CSS.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>O bien, prueba contra el contenido de la respuesta directamente si lo que deseas es acertar que el contenido contiene algún texto, o si la respuesta no es un documento <em>XML</em> o <em>HTML</em>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertRegExp</span><span class="p">(</span><span class="s1">&#39;/Hello Fabien/&#39;</span><span class="p">,</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">());</span>
</pre></div>
</div>
<div class="sidebar" id="book-testing-request-method-sidebar">
<p class="first sidebar-title">Más sobre el método <tt class="docutils literal"><span class="pre">request()</span></tt>:</p>
<p>La firma completa del método <tt class="docutils literal"><span class="pre">request()</span></tt> es la siguiente:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nx">request</span><span class="p">(</span>
    <span class="nv">$method</span><span class="p">,</span>
    <span class="nv">$uri</span><span class="p">,</span>
    <span class="k">array</span> <span class="nv">$parameters</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span> <span class="nv">$files</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span> <span class="nv">$server</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
    <span class="nv">$changeHistory</span> <span class="o">=</span> <span class="k">true</span>
<span class="p">)</span>
</pre></div>
</div>
<p>El arreglo <tt class="docutils literal"><span class="pre">server</span></tt> son los valores crudos que esperarías encontrar normalmente en la superglobal <a class="reference external" href="http://www.php.net/manual/es/reserved.variables.server.php">$_SERVER</a> de <em>PHP</em>. Por ejemplo, para establecer las cabeceras <em>HTTP</em> <tt class="docutils literal"><span class="pre">Content-Type</span></tt> y <tt class="docutils literal"><span class="pre">Referer</span></tt>, deberías pasar lo siguiente:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span>
    <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/demo/hello/Fabien&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;CONTENT_TYPE&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HTTP_REFERER&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/foo/bar&#39;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="sidebar" id="index-3">
<p class="first sidebar-title">Útiles aserciones</p>
<p>Para empezar más rápido, aquí tienes una lista de las aserciones más comunes y útiles:</p>
<div class="last highlight-php"><div class="highlight"><pre><span class="c1">// Afirma que hay más de una etiqueta h2 con la clase &quot;subtitle&quot;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;h2.subtitle&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// Afirma que en la página hay exactamente 4 etiquetas h2</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">());</span>

<span class="c1">// Afirma que la cabecera &quot;Content-Type&quot; es &quot;application/json&quot;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">contains</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">));</span>

<span class="c1">// Acierta que el contenido de la respuesta concuerda con una expresión regular.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertRegExp</span><span class="p">(</span><span class="s1">&#39;/foo/&#39;</span><span class="p">,</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">());</span>

<span class="c1">// Acierta que el código de estado de la respuesta es 2xx</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isSuccessful</span><span class="p">());</span>
<span class="c1">// Acierta que el código de estado de la respuesta es 404</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isNotFound</span><span class="p">());</span>
<span class="c1">// Acierta un código de estado 200 específico</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">());</span>

<span class="c1">// Acierta que la respuesta es una redirección a &#39;/demo/contact&#39;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isRedirect</span><span class="p">(</span><span class="s1">&#39;/demo/contact&#39;</span><span class="p">));</span>
<span class="c1">// o simplemente comprueba que la respuesta es una redirección a cualquier URL</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isRedirect</span><span class="p">());</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="trabajando-con-el-cliente-de-pruebas">
<span id="index-4"></span><h2>Trabajando con el Cliente de pruebas<a class="headerlink" href="#trabajando-con-el-cliente-de-pruebas" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El Cliente de prueba simula un cliente <em>HTTP</em> tal como un navegador y hace peticiones a tu aplicación <em>Symfony2</em>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/hello/Fabien&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>El método <tt class="docutils literal"><span class="pre">request()</span></tt> toma el método <em>HTTP</em> y una <em>URL</em> como argumentos y devuelve una instancia de <tt class="docutils literal"><span class="pre">Crawler</span></tt>.</p>
<p>Utiliza el rastreador para encontrar elementos del <em>DOM</em> en la respuesta. Puedes utilizar estos elementos para hacer clic en los enlaces y presentar formularios:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$link</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;Go elsewhere...&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>

<span class="nv">$form</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectButton</span><span class="p">(</span><span class="s1">&#39;validate&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">();</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Ambos métodos <tt class="docutils literal"><span class="pre">click()</span></tt> y <tt class="docutils literal"><span class="pre">submit()</span></tt> devuelven un objeto <tt class="docutils literal"><span class="pre">Crawler</span></tt>.
Estos métodos son la mejor manera para navegar por tu aplicación permitiéndole se preocupe de un montón de detalles por ti, tal como detectar el método <em>HTTP</em> de un formulario y proporcionándote una buena <em>API</em> para cargar archivos.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Aprenderás más sobre los objetos <tt class="docutils literal"><span class="pre">Link</span></tt> y <tt class="docutils literal"><span class="pre">Form</span></tt> más adelante en la sección <a class="reference internal" href="#book-testing-crawler"><em>Crawler</em></a>.</p>
</div>
<p>También puedes usar el método <tt class="docutils literal"><span class="pre">request</span></tt> para simular el envío de formularios directamente o realizar peticiones más complejas:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// envía un formulario directamente (¡Pero es más fácil usando el &#39;Crawler&#39;!)</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/submit&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">));</span>

<span class="c1">// envía un formulario con un campo para subir un archivo</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\UploadedFile</span><span class="p">;</span>

<span class="nv">$photo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UploadedFile</span><span class="p">(</span>
    <span class="s1">&#39;/path/to/photo.jpg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;photo.jpg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;image/jpeg&#39;</span><span class="p">,</span>
    <span class="mi">123</span>
<span class="p">);</span>
<span class="c1">// o</span>
<span class="nv">$photo</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;tmp_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/path/to/photo.jpg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;photo.jpg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;image/jpeg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span> <span class="o">=&gt;</span> <span class="mi">123</span><span class="p">,</span>
    <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nx">UPLOAD_ERR_OK</span>
<span class="p">);</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span>
    <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/submit&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span> <span class="o">=&gt;</span> <span class="nv">$photo</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Realiza una petición DELETE, y pasa las cabeceras HTTP</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span>
    <span class="s1">&#39;DELETE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/post/12&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;PHP_AUTH_USER&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;PHP_AUTH_PW&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pa$$word&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Por último pero no menos importante, puedes hacer que cada petición se ejecute en su propio proceso <em>PHP</em> para evitar efectos secundarios cuando se trabaja con varios clientes en el mismo archivo:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">insulate</span><span class="p">();</span>
</pre></div>
</div>
<div class="section" id="navegando">
<h3>Navegando<a class="headerlink" href="#navegando" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El cliente es compatible con muchas operaciones que se pueden hacer en un navegador real:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">back</span><span class="p">();</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">();</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">reload</span><span class="p">();</span>

<span class="c1">// Limpia todas las cookies y el historial</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">restart</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="accediendo-a-objetos-internos">
<h3>Accediendo a objetos internos<a class="headerlink" href="#accediendo-a-objetos-internos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Si utilizas el cliente para probar tu aplicación, posiblemente quieras acceder a los objetos internos del cliente:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$history</span>   <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getHistory</span><span class="p">();</span>
<span class="nv">$cookieJar</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getCookieJar</span><span class="p">();</span>
</pre></div>
</div>
<p>También puedes obtener los objetos relacionados con la última petición:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$request</span>  <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getRequest</span><span class="p">();</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">();</span>
<span class="nv">$crawler</span>  <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getCrawler</span><span class="p">();</span>
</pre></div>
</div>
<p>Si tus peticiones no son aisladas, también puedes acceder al <tt class="docutils literal"><span class="pre">Contenedor</span></tt> y al <tt class="docutils literal"><span class="pre">kernel</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$container</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getContainer</span><span class="p">();</span>
<span class="nv">$kernel</span>    <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getKernel</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="accediendo-al-contenedor">
<h3>Accediendo al contenedor<a class="headerlink" href="#accediendo-al-contenedor" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Es altamente recomendable que una prueba funcional sólo pruebe la respuesta. Sin embargo, bajo ciertas circunstancias muy raras, posiblemente desees acceder a algunos objetos internos para escribir aserciones. En tales casos, puedes acceder al contenedor de inyección de dependencias:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$container</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getContainer</span><span class="p">();</span>
</pre></div>
</div>
<p>Ten en cuenta que esto no tiene efecto si aíslas el cliente o si utilizas una capa <em>HTTP</em>. Para listar todos los servicios disponibles en tu aplicación, utiliza la orden <tt class="docutils literal"><span class="pre">container:debug</span></tt> de la consola.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Si la información que necesitas comprobar está disponible desde el generador de perfiles, úsala en su lugar.</p>
</div>
</div>
<div class="section" id="accediendo-a-los-datos-del-perfil">
<h3>Accediendo a los datos del perfil<a class="headerlink" href="#accediendo-a-los-datos-del-perfil" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En cada petición, el generador de perfiles de <em>Symfony</em> recoge y guarda una gran variedad de datos sobre el manejo interno de la petición. Por ejemplo, puedes usar el generador de perfiles para verificar que cuando se carga una determinada página ejecuta menos de una cierta cantidad de consultas a la base de datos.</p>
<p>Para obtener el generador de perfiles de la última petición, haz lo siguiente:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getProfile</span><span class="p">();</span>
</pre></div>
</div>
<p>Para detalles específicos en el uso del generador de perfiles en una prueba, consulta el artículo <a class="reference internal" href="../cookbook/testing/profiling.html"><em>Cómo utilizar el generador de perfiles en una prueba funcional</em></a> en el recetario.</p>
</div>
<div class="section" id="redirigiendo">
<h3>Redirigiendo<a class="headerlink" href="#redirigiendo" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando una petición devuelve una respuesta de redirección, el cliente la sigue automáticamente. Si deseas examinar la <tt class="docutils literal"><span class="pre">Respuesta</span></tt> antes de redirigir, puedes hacer que el cliente no siga los cambios de dirección con el método <tt class="docutils literal"><span class="pre">followRedirects()</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">followRedirects</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</pre></div>
</div>
<p>Cuando el cliente no sigue los cambios de dirección, puedes forzar el cambio de dirección con el método <tt class="docutils literal"><span class="pre">followRedirect()</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">followRedirect</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="el-crawler">
<span id="book-testing-crawler"></span><span id="index-5"></span><h2>El <tt class="docutils literal"><span class="pre">Crawler</span></tt><a class="headerlink" href="#el-crawler" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Cada vez que hagas una petición con el cliente devolverá una instancia del <tt class="docutils literal"><span class="pre">Crawler</span></tt>.
Este nos permite recorrer documentos <em>HTML</em>, seleccionar nodos, encontrar enlaces y formularios.</p>
<div class="section" id="recorriendo">
<h3>Recorriendo<a class="headerlink" href="#recorriendo" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Al igual que <em>jQuery</em>, el <tt class="docutils literal"><span class="pre">Crawler</span></tt> tiene métodos para recorrer el <em>DOM</em> de un documento <em>HTML</em>/<em>XML</em>: Por ejemplo, el siguiente fragmento encuentra todos los elementos <tt class="docutils literal"><span class="pre">input[type=submit]</span></tt>, selecciona el último en la página, y luego selecciona el elemento padre inmediato:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$newCrawler</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;input[type=submit]&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">last</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">parents</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">first</span><span class="p">()</span>
<span class="p">;</span>
</pre></div>
</div>
<p>Disponemos de muchos otros métodos:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Método</th>
<th class="head">Descripción</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">filter('h1.title')</span></tt></td>
<td>Nodos que coinciden con el selector <em>CSS</em></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">filterXpath('h1')</span></tt></td>
<td>Nodos que coinciden con la expresión <em>XPath</em></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">eq(1)</span></tt></td>
<td>Nodo para el índice especificado</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">first()</span></tt></td>
<td>Primer nodo</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">last()</span></tt></td>
<td>Último nodo</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">siblings()</span></tt></td>
<td>Hermanos</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">nextAll()</span></tt></td>
<td>Todos los hermanos siguientes</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">previousAll()</span></tt></td>
<td>Todos los hermanos precedentes</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">parents()</span></tt></td>
<td>Devuelve los nodos padre</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">children()</span></tt></td>
<td>Devuelve los nodos hijo</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">reduce($lambda)</span></tt></td>
<td>Nodos para los cuales el ejecutable no devuelve
<tt class="docutils literal"><span class="pre">false</span></tt></td>
</tr>
</tbody>
</table>
<p>Debido a que cada uno de estos métodos devuelve una nueva instancia del <tt class="docutils literal"><span class="pre">Crawler</span></tt>, puedes reducir tu selección de nodos encadenando las llamadas al método:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$crawler</span>
    <span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">reduce</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Usa la función <tt class="docutils literal"><span class="pre">count()</span></tt> para obtener el número de nodos almacenados en un <tt class="docutils literal"><span class="pre">Crawler</span></tt>:
<tt class="docutils literal"><span class="pre">count($crawler)</span></tt></p>
</div>
</div>
<div class="section" id="extrayendo-informacion">
<h3>Extrayendo información<a class="headerlink" href="#extrayendo-informacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El <tt class="docutils literal"><span class="pre">Crawler</span></tt> puede extraer información de los nodos:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// Devuelve el valor del atributo del primer nodo</span>
<span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">);</span>

<span class="c1">// Devuelve el valor del nodo para el primer nodo</span>
<span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>

<span class="c1">// Extrae un arreglo de atributos de todos los nodos (_text devuelve el valor del nodo)</span>
<span class="c1">// devuelve un arreglo de cada elemento en &#39;crawler&#39;, cada cual con su valor y href</span>
<span class="nv">$info</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;_text&#39;</span><span class="p">,</span> <span class="s1">&#39;href&#39;</span><span class="p">));</span>

<span class="c1">// Ejecuta una función anónima por cada nodo y devuelve un arreglo de resultados</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="enlaces">
<h3>Enlaces<a class="headerlink" href="#enlaces" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para seleccionar enlaces, puedes usar los métodos de recorrido anteriores o el conveniente atajo <tt class="docutils literal"><span class="pre">selectLink()</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;Click here&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Este selecciona todos los enlaces que contienen el texto dado, o hace clic en las imágenes en que el atributo <tt class="docutils literal"><span class="pre">alt</span></tt> contiene el texto dado. Al igual que los otros métodos de filtrado, devuelve otro objeto <tt class="docutils literal"><span class="pre">Crawler</span></tt>.</p>
<p>Una vez seleccionado un enlace, tienes acceso al objeto especial <tt class="docutils literal"><span class="pre">Link</span></tt>, el cual tiene útiles métodos específicos para enlaces (tal como <tt class="docutils literal"><span class="pre">getMethod()</span></tt> y
<tt class="docutils literal"><span class="pre">getUri()</span></tt>). Para hacer clic en el enlace, usa el método <tt class="docutils literal"><span class="pre">click()</span></tt> del cliente suministrando un objeto <tt class="docutils literal"><span class="pre">Link</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$link</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;Click here&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>

<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="formularios">
<h3>Formularios<a class="headerlink" href="#formularios" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Al igual que con cualquier otro enlace, seleccionas el formulario con el método <tt class="docutils literal"><span class="pre">selectButton()</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$buttonCrawlerNode</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectButton</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Ten en cuenta que seleccionamos botones del formulario y no el formulario porque un formulario puede tener varios botones; si utilizas la <em>API</em> para recorrerlo, ten en cuenta que debes buscar un botón.</p>
</div>
<p>El método <tt class="docutils literal"><span class="pre">selectButton()</span></tt> puede seleccionar etiquetas <tt class="docutils literal"><span class="pre">button</span></tt> y enviar etiquetas <tt class="docutils literal"><span class="pre">input</span></tt>; Este usa diferentes partes de los botones para encontrarlos:</p>
<ul class="simple">
<li>El valor del atributo <tt class="docutils literal"><span class="pre">value</span></tt>;</li>
<li>El valor del atributo <tt class="docutils literal"><span class="pre">id</span></tt> o <tt class="docutils literal"><span class="pre">alt</span></tt> de imágenes;</li>
<li>El valor del atributo <tt class="docutils literal"><span class="pre">id</span></tt> o <tt class="docutils literal"><span class="pre">name</span></tt> de las etiquetas <tt class="docutils literal"><span class="pre">button</span></tt>.</li>
</ul>
<p>Una vez que tienes un <tt class="docutils literal"><span class="pre">Crawler</span></tt> que representa un botón, invoca al método <tt class="docutils literal"><span class="pre">form()</span></tt> para obtener la instancia del <tt class="docutils literal"><span class="pre">Formulario</span></tt> del nodo del formulario que envuelve al botón:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$buttonCrawlerNode</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">();</span>
</pre></div>
</div>
<p>Cuando llamas al método <tt class="docutils literal"><span class="pre">form()</span></tt>, también puedes pasar una matriz de valores de campo que sustituyan los valores predeterminados:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$buttonCrawlerNode</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span>              <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">,</span>
    <span class="s1">&#39;my_form[subject]&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Symfony rocks!&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</div>
<p>Y si quieres simular un método <em>HTTP</em> específico del formulario, pásalo como segundo argumento:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$buttonCrawlerNode</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">(</span><span class="k">array</span><span class="p">(),</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>El cliente puede enviar instancias de <tt class="docutils literal"><span class="pre">Form</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$form</span><span class="p">);</span>
</pre></div>
</div>
<p>Los valores del campo también se pueden pasar como segundo argumento del método <tt class="docutils literal"><span class="pre">submit()</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span>              <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">,</span>
    <span class="s1">&#39;my_form[subject]&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Symfony rocks!&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</div>
<p>Para situaciones más complejas, utiliza la instancia de <tt class="docutils literal"><span class="pre">Form</span></tt> como una matriz para establecer el valor de cada campo individualmente:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// Cambia el valor de un campo</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">;</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;my_form[subject]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Symfony rocks!&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>También hay una buena <em>API</em> para manipular los valores de los campos de acuerdo a su tipo:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// selecciona una opción o un botón de radio</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;France&#39;</span><span class="p">);</span>

<span class="c1">// marca una casilla de verificación (checkbox)</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;like_symfony&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">tick</span><span class="p">();</span>

<span class="c1">// carga un archivo</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;photo&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">upload</span><span class="p">(</span><span class="s1">&#39;/ruta/a/lucas.jpg&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Puedes conseguir los valores que se enviarán llamando al método <tt class="docutils literal"><span class="pre">getValues()</span></tt> del objeto <tt class="docutils literal"><span class="pre">Form</span></tt>. Los archivos subidos están disponibles en un arreglo separado devuelto por <tt class="docutils literal"><span class="pre">getFiles()</span></tt>. Los métodos <tt class="docutils literal"><span class="pre">getPhpValues()</span></tt> y <tt class="docutils literal"><span class="pre">getPhpFiles()</span></tt> también devuelven los valores enviados, pero en formato <em>PHP</em> (este convierte las claves en notación con paréntesis cuadrados &#8212;por ejemplo, <tt class="docutils literal"><span class="pre">my_form[subject]</span></tt>&#8212; a arreglos <em>PHP</em>).</p>
</div>
</div>
</div>
<div class="section" id="probando-la-configuracion">
<span id="index-6"></span><h2>Probando la configuración<a class="headerlink" href="#probando-la-configuracion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El cliente utilizado por las pruebas funcionales crea un núcleo que se ejecuta en un entorno de <tt class="docutils literal"><span class="pre">prueba</span></tt> especial. Debido a que <em>Symfony</em> carga el <tt class="docutils literal"><span class="pre">app/config/config_test.yml</span></tt>
en el entorno <tt class="docutils literal"><span class="pre">test</span></tt>, puedes ajustar cualquiera de las opciones de tu aplicación específicamente para pruebas.</p>
<p>Por ejemplo, por omisión, el <tt class="docutils literal"><span class="pre">swiftmailer</span></tt> está configurado para que en el entorno <tt class="docutils literal"><span class="pre">test</span></tt> <em>no</em> se entregue realmente el correo electrónico. Lo puedes ver bajo la opción de configuración <tt class="docutils literal"><span class="pre">swiftmailer</span></tt>.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config_test.yml</span>
<span class="c1"># ...</span>

<span class="l-Scalar-Plain">swiftmailer</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">disable_delivery</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config_test.xml --&gt;</span>
<span class="nt">&lt;container&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>

    <span class="nt">&lt;swiftmailer:config</span> <span class="na">disable-delivery=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/config_test.php</span>
<span class="c1">// ...</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;swiftmailer&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;disable_delivery&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Además, puedes usar un entorno completamente diferente, o redefinir el modo de depuración predeterminado (<tt class="docutils literal"><span class="pre">true</span></tt>) pasando cada opción al método <tt class="docutils literal"><span class="pre">createClient()</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$client</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">createClient</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;environment&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my_test_env&#39;</span><span class="p">,</span>
    <span class="s1">&#39;debug&#39;</span>       <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</div>
<p>Si tu aplicación se comporta de acuerdo a algunas cabeceras <em>HTTP</em>, pásalas como segundo argumento de <tt class="docutils literal"><span class="pre">createClient()</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$client</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">createClient</span><span class="p">(</span><span class="k">array</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;HTTP_HOST&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;en.example.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HTTP_USER_AGENT&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;MySuperBrowser/1.0&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</div>
<p>También puedes reemplazar cabeceras <em>HTTP</em> en base a la petición:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="k">array</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;HTTP_HOST&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;en.example.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HTTP_USER_AGENT&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;MySuperBrowser/1.0&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">El cliente de prueba está disponible como un servicio en el contenedor del entorno <tt class="docutils literal"><span class="pre">test</span></tt> (o cuando está habilitada la opción <a class="reference internal" href="../reference/configuration/framework.html#reference-framework-test"><em>framework.test</em></a>). Esto significa que &#8212;de ser necesario&#8212; puedes redefinir el servicio completamente.</p>
</div>
<div class="section" id="configuracion-de-phpunit">
<span id="index-7"></span><h3>Configuración de <em>PHPUnit</em><a class="headerlink" href="#configuracion-de-phpunit" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cada aplicación tiene su propia configuración de <em>PHPUnit</em>, almacenada en el archivo <tt class="docutils literal"><span class="pre">phpunit.xml.dist</span></tt>. Puedes editar este archivo para cambiar los valores predeterminados o crear un archivo <tt class="file docutils literal"><span class="pre">phpunit.xml</span></tt> para modificar la configuración de tu máquina local.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Guarda el archivo <tt class="file docutils literal"><span class="pre">phpunit.xml.dist</span></tt> en tu repositorio de código, e ignora el archivo <tt class="file docutils literal"><span class="pre">phpunit.xml</span></tt>.</p>
</div>
<p>De forma predeterminada, la orden <tt class="docutils literal"><span class="pre">PHPUnit</span></tt> sólo ejecuta las pruebas almacenadas en los paquetes &#8220;estándar&#8221; (las pruebas estándar están en el directorio <tt class="file docutils literal"><span class="pre">src/*/Bundle/Tests</span></tt> o <tt class="file docutils literal"><span class="pre">src/*/Bundle/*Bundle/Tests</span></tt>), pero fácilmente puedes añadir más directorios. Por ejemplo, la siguiente configuración añade las pruebas de los paquetes de terceros que has instalado:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- hello/phpunit.xml.dist --&gt;</span>
<span class="nt">&lt;testsuites&gt;</span>
    <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;Project Test Suite&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;directory&gt;</span>../src/Acme/Bundle/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
    <span class="nt">&lt;/testsuite&gt;</span>
<span class="nt">&lt;/testsuites&gt;</span>
</pre></div>
</div>
<p>Para incluir otros directorios en la cobertura de código, también edita la sección <tt class="docutils literal"><span class="pre">&lt;filter&gt;</span></tt>:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;whitelist&gt;</span>
        <span class="nt">&lt;directory&gt;</span>../src<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;exclude&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Resources<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/*/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/Acme/Bundle/*Bundle/Resources<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;directory&gt;</span>../src/Acme/Bundle/*Bundle/Tests<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;/exclude&gt;</span>
    <span class="nt">&lt;/whitelist&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="aprende-mas-en-el-recetario">
<h2>Aprende más en el recetario<a class="headerlink" href="#aprende-mas-en-el-recetario" title="Enlazar permanentemente con este título">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../cookbook/testing/http_authentication.html"><em>Cómo simular autenticación HTTP en una prueba funcional</em></a></li>
<li><a class="reference internal" href="../cookbook/testing/insulating_clients.html"><em>Cómo probar la interacción de varios clientes</em></a></li>
<li><a class="reference internal" href="../cookbook/testing/profiling.html"><em>Cómo utilizar el generador de perfiles en una prueba funcional</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <a href="https://github.com/symfony/symfony-standard"><img style="position: fixed; top: 0; right: 0; border: 0;" src="http://gitnacho.github.com/tnp/img/comun/bifurcame.png" alt="Bifúrcame en GitHub" /></a>
  
  <div style="width:740px;margin:10px auto;">
    
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="validation.html" title="Validando"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="doctrine.html" title="Bases de datos y Doctrine (“El modelo”)"
             >anterior</a> |</li>
        <li><a href="../index.html">en Español</a> &raquo;</li>
          <li><a href="index.html" >Libro</a> &raquo;</li> 
      </ul>
    </div>
  </div>


   <div style="width: 740px; margin: 0 auto;">
     <div id="disqus_thread"></div>
     
    <div class="footer">
        &copy; Copyright 2011-2012, Traducido por Nacho Pacheco.
      Actualizado por última vez en Jun 14, 2012.
      Creado con <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
   </div>
   <script type="text/javascript">
    var disqus_shortname = 'documentos-mx';
    var disqus_developer = 1;
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
   </script>
   <noscript>
     Por favor activa JavaScript para ver los <a href="http://disqus.com/?ref_noscript">comentarios accionados por Disqus.</a>
   </noscript>

  </body>
</html>