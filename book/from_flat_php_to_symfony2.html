
<!DOCTYPE html> 
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Symfony2 frente a PHP simple &mdash; Manual de Symfony2 en Español</title>
    
    <link rel="stylesheet" href="../_static/tnp.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.15',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/icotnp.ico"/>
    <link rel="top" title="Manual de Symfony2 en Español" href="../index.html" />
    <link rel="up" title="Libro" href="index.html" />
    <link rel="next" title="Instalando y configurando Symfony" href="installation.html" />
    <link rel="prev" title="Symfony2 y fundamentos HTTP" href="http_fundamentals.html" /> 
  </head>
  <body>
  <div class="imalogo">
    
  <a href="../index.html"><img src="http://gitnacho.github.com/tnp/img/sf/logo-big.gif" alt="Edición estándar de Symfony2" />
  
    <a href="../index.html"><img src="http://gitnacho.github.com/tnp/_static/normaltnp.png" alt="Traducciones de Nacho Pacheco" /></a>
    <div class="social">
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="esymfony" data-lang="es">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
    <div id="searchbox">
      <form class="searc " action="../search.html" method="get">
      <input type="search" name="q" placeholder="Término a buscar" />
      <input type="submit" value="Ir" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
    

    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="installation.html" title="Instalando y configurando Symfony"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="http_fundamentals.html" title="Symfony2 y fundamentos HTTP"
             accesskey="P">anterior</a> |</li>
        <li><a href="../index.html">en Español</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Libro</a> &raquo;</li> 
      </ul>
    </div>
  </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="symfony2-frente-a-php-simple">
<h1><em>Symfony2</em> frente a <em>PHP</em> simple<a class="headerlink" href="#symfony2-frente-a-php-simple" title="Enlazar permanentemente con este título">¶</a></h1>
<p><strong>¿Por qué Symfony2 es mejor que sólo abrir un archivo y escribir PHP simple?</strong></p>
<p>Si nunca has usado una plataforma <em>PHP</em>, no estás familiarizado con la filosofía <em>MVC</em>, o simplemente te preguntas qué es todo ese <em>alboroto</em> en torno a <em>Symfony2</em>, este capítulo es para ti. En vez de <em>decirte</em> que <em>Symfony2</em> te permite desarrollar software más rápido y mejor que con <em>PHP</em> simple, debes verlo tú mismo.</p>
<p>En este capítulo, vamos a escribir una aplicación sencilla en <em>PHP</em> simple, y luego la reconstruiremos para que esté mejor organizada. Podrás viajar a través del tiempo, viendo las decisiones de por qué el desarrollo web ha evolucionado en los últimos años hasta donde está ahora.</p>
<p>Al final, verás cómo <em>Symfony2</em> te puede rescatar de las tareas cotidianas y te permite recuperar el control de tu código.</p>
<div class="section" id="un-sencillo-blog-en-php-simple">
<h2>Un sencillo <em>blog</em> en <em>PHP</em> simple<a class="headerlink" href="#un-sencillo-blog-en-php-simple" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En este capítulo, crearemos una simbólica aplicación de <em>blog</em> utilizando sólo <em>PHP</em> simple.
Para empezar, crea una página que muestre las entradas del <em>blog</em> que se han persistido en la base de datos. Escribirla en <em>PHP</em> simple es rápido y sucio:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>
<span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;myuser&#39;</span><span class="p">,</span> <span class="s1">&#39;mypassword&#39;</span><span class="p">);</span>
<span class="nb">mysql_select_db</span><span class="p">(</span><span class="s1">&#39;blog_db&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s1">&#39;SELECT id, title FROM post&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>
<span class="cp">?&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
    <span class="nt">&lt;html&gt;</span>
        <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>List of Posts<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;/head&gt;</span>
        <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1&gt;</span>List of Posts<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/show.php?id=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>
                    <span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">endwhile</span><span class="p">;</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

<span class="cp">&lt;?php</span>
<span class="nb">mysql_close</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</pre></div>
</div>
<p>Eso es fácil de escribir, se ejecuta rápido, y, cuando tu aplicación crece, imposible de mantener. Hay varios problemas que es necesario abordar:</p>
<ul class="simple">
<li><strong>No hay comprobación de errores</strong>: ¿Qué sucede si falla la conexión a la base de datos?</li>
<li><strong>Deficiente organización</strong>: Si la aplicación crece, este único archivo cada vez será más difícil de mantener, hasta que finalmente sea imposible. ¿Dónde se debe colocar el código para manejar un formulario enviado? ¿Cómo se pueden validar los datos? ¿Dónde debe ir el código para enviar mensajes de correo electrónico?</li>
<li><strong>Es difícil reutilizar el código</strong>: Ya que todo está en un archivo, no hay manera de volver a utilizar alguna parte de la aplicación en otras «páginas» del <em>blog</em>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Otro problema no mencionado aquí es el hecho de que la base de datos está vinculada a <em>MySQL</em>. Aunque no se ha tratado aquí, <em>Symfony2</em> integra <a class="reference external" href="http://www.doctrine-project.org">Doctrine</a> plenamente, una biblioteca dedicada a la abstracción y asignación de bases de datos.</p>
</div>
<p>Trabajaremos en la solución de estos y muchos problemas más.</p>
<div class="section" id="aislando-la-presentacion">
<h3>Aislando la presentación<a class="headerlink" href="#aislando-la-presentacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El código inmediatamente se puede beneficiar de la separación entre la «lógica» de la aplicación y el código que prepara la «presentación» <em>HTML</em>:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>
<span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;myuser&#39;</span><span class="p">,</span> <span class="s1">&#39;mypassword&#39;</span><span class="p">);</span>
<span class="nb">mysql_select_db</span><span class="p">(</span><span class="s1">&#39;blog_db&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s1">&#39;SELECT id, title FROM post&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>

<span class="nv">$posts</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$posts</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">mysql_close</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>

<span class="c1">// incluye el código HTML de la presentación</span>
<span class="k">require</span> <span class="s1">&#39;templates/list.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Ahora el código <em>HTML</em> está guardado en un archivo separado (<tt class="docutils literal"><span class="pre">templates/list.php</span></tt>), el cual principalmente es un archivo <em>HTML</em> que utiliza una sintaxis de plantilla tipo <em>PHP</em>:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
    <span class="nt">&lt;html&gt;</span>
        <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>List of Posts<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;/head&gt;</span>
        <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1&gt;</span>List of Posts<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$posts</span> <span class="k">as</span> <span class="nv">$post</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/read?id=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>
                    <span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Por convención, el archivo que contiene toda la lógica de la aplicación &#8212;<tt class="file docutils literal"><span class="pre">index.php</span></tt>&#8212; se conoce como <em>«controlador»</em>. El término <a class="reference internal" href="../glossary.html#term-controlador"><em class="xref std std-term">controlador</em></a> es una palabra que se escucha mucho, independientemente del lenguaje o plataforma que utilices. Simplemente se refiere a la zona de <em>tu código</em> que procesa la entrada del usuario y prepara la respuesta.</p>
<p>En este caso, el controlador prepara los datos de la base de datos y, luego los incluye en una plantilla para presentarlos. Con el controlador aislado, fácilmente podríamos cambiar <em>sólo</em> el archivo de plantilla si es necesario procesar las entradas del <em>blog</em> en algún otro formato (por ejemplo, <tt class="docutils literal"><span class="pre">lista.json.php</span></tt> para el formato <em>JSON</em>).</p>
</div>
<div class="section" id="aislando-la-logica-de-la-aplicacion-el-dominio">
<h3>Aislando la lógica de la aplicación (el dominio)<a class="headerlink" href="#aislando-la-logica-de-la-aplicacion-el-dominio" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Hasta ahora, la aplicación sólo contiene una página. Pero ¿qué pasa si una segunda página necesita utilizar la misma conexión a la base de datos, e incluso el mismo arreglo de entradas del <em>blog</em>? Reconstruye el código para que el comportamiento de las funciones básicas de acceso a datos de la aplicación esté aislado en un nuevo archivo llamado <tt class="file docutils literal"><span class="pre">model.php</span></tt>:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// model.php</span>
<span class="k">function</span> <span class="nf">open_database_connection</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;myuser&#39;</span><span class="p">,</span> <span class="s1">&#39;mypassword&#39;</span><span class="p">);</span>
    <span class="nb">mysql_select_db</span><span class="p">(</span><span class="s1">&#39;blog_db&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$link</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">close_database_connection</span><span class="p">(</span><span class="nv">$link</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nb">mysql_close</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">get_all_posts</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$link</span> <span class="o">=</span> <span class="nx">open_database_connection</span><span class="p">();</span>

    <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s1">&#39;SELECT id, title FROM post&#39;</span><span class="p">,</span> <span class="nv">$link</span><span class="p">);</span>
    <span class="nv">$posts</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$posts</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">close_database_connection</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$posts</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Utilizamos el nombre de archivo <tt class="file docutils literal"><span class="pre">model.php</span></tt> debido a que el acceso a la lógica y los datos de una aplicación, tradicionalmente, se conoce como la capa del «modelo». En una aplicación bien organizada, la mayoría del código que representa tu «lógica de negocio» debe vivir en el modelo (en lugar de vivir en un controlador). Y, a diferencia de este ejemplo, sólo una parte (o ninguna) del modelo realmente está interesada en acceder a la base de datos.</p>
</div>
<p>El controlador (<tt class="file docutils literal"><span class="pre">index.php</span></tt>) ahora es muy sencillo:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">&#39;model.php&#39;</span><span class="p">;</span>

<span class="nv">$posts</span> <span class="o">=</span> <span class="nx">get_all_posts</span><span class="p">();</span>

<span class="k">require</span> <span class="s1">&#39;templates/list.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Ahora, la única tarea del controlador es conseguir los datos de la capa del modelo de la aplicación (el modelo) e invocar a una plantilla que reproduce los datos.
Este es un ejemplo muy simple del patrón modelo-vista-controlador.</p>
</div>
<div class="section" id="aislando-el-diseno">
<h3>Aislando el diseño<a class="headerlink" href="#aislando-el-diseno" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En este punto, reconstruiste la aplicación en tres piezas distintas, mismas que ofrecen varias ventajas y la oportunidad de volver a utilizar casi todo en diferentes páginas.</p>
<p>La única parte del código que <em>no</em> se puede reutilizar es el diseño de la página. Corregirás esto creando un nuevo archivo <tt class="file docutils literal"><span class="pre">base.php</span></tt>:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="c">&lt;!-- templates/base.php --&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
    <span class="nt">&lt;html&gt;</span>
        <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$title</span> <span class="cp">?&gt;</span><span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;/head&gt;</span>
        <span class="nt">&lt;body&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$content</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>La plantilla (<tt class="docutils literal"><span class="pre">templates/list.php</span></tt>) ahora se puede simplificar para «extender» el diseño:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="nv">$title</span> <span class="o">=</span> <span class="s1">&#39;List of Posts&#39;</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="nb">ob_start</span><span class="p">()</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;h1&gt;</span>List of Posts<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$posts</span> <span class="k">as</span> <span class="nv">$post</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;li&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/read?id=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>
                <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="cp">&lt;?php</span> <span class="nv">$content</span> <span class="o">=</span> <span class="nb">ob_get_clean</span><span class="p">()</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="k">include</span> <span class="s1">&#39;base.php&#39;</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>Ahora se introdujo una metodología que te permite reutilizar el diseño. Desafortunadamente, para lograrlo, estás obligado a utilizar en la plantilla algunas desagradables funciones de <em>PHP</em> (<tt class="docutils literal"><span class="pre">ob_start()</span></tt>, <tt class="docutils literal"><span class="pre">ob_get_clean()</span></tt>). <em>Symfony2</em> utiliza un componente <tt class="docutils literal"><span class="pre">Templating</span></tt> que te permite realizar esto limpia y fácilmente. En breve lo verás en acción.</p>
</div>
</div>
<div class="section" id="agregando-una-pagina-show-al-blog">
<h2>Agregando una página <tt class="docutils literal"><span class="pre">«show»</span></tt> al <em>blog</em><a class="headerlink" href="#agregando-una-pagina-show-al-blog" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La página <tt class="docutils literal"><span class="pre">«list»</span></tt> del <em>blog</em> se ha rediseñado para que el código esté mejor organizado y sea reutilizable. Para probarlo, añade una página <tt class="docutils literal"><span class="pre">«show»</span></tt> al <em>blog</em>, que muestre una entrada individual del <em>blog</em> identificada por un parámetro de consulta <tt class="docutils literal"><span class="pre">id</span></tt>.</p>
<p>Para empezar, crea una nueva función en el archivo <tt class="file docutils literal"><span class="pre">model.php</span></tt> que recupere un resultado individual del <em>blog</em> basándose en un identificador dado:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// model.php</span>
<span class="k">function</span> <span class="nf">get_post_by_id</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$link</span> <span class="o">=</span> <span class="nx">open_database_connection</span><span class="p">();</span>

    <span class="nv">$id</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
    <span class="nv">$query</span> <span class="o">=</span> <span class="s1">&#39;SELECT date, title, body FROM post WHERE id = &#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">;</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
    <span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

    <span class="nx">close_database_connection</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$row</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A continuación, crea un nuevo archivo llamado <tt class="file docutils literal"><span class="pre">show.php</span></tt> &#8212;el controlador para esta nueva página:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">&#39;model.php&#39;</span><span class="p">;</span>

<span class="nv">$post</span> <span class="o">=</span> <span class="nx">get_post_by_id</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>

<span class="k">require</span> <span class="s1">&#39;templates/show.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Por último, crea el nuevo archivo de plantilla &#8212;<tt class="docutils literal"><span class="pre">templates/show.php</span></tt>&#8212; para reproducir una entrada individual del <em>blog</em>:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="nv">$title</span> <span class="o">=</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="nb">ob_start</span><span class="p">()</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;h1&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;date&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;body&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;?php</span> <span class="nv">$content</span> <span class="o">=</span> <span class="nb">ob_get_clean</span><span class="p">()</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="k">include</span> <span class="s1">&#39;base.php&#39;</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>Ahora, es muy fácil crear la segunda página y sin duplicar código. Sin embargo, esta página introduce problemas aún más perniciosos que una plataforma puede resolver por ti. Por ejemplo, un parámetro <tt class="docutils literal"><span class="pre">id</span></tt> ilegal u omitido en la consulta hará que la página se bloquee. Sería mejor si esto reprodujera una página 404, pero sin embargo, en realidad esto no se puede hacer fácilmente. Peor aún, si olvidaras desinfectar el parámetro <tt class="docutils literal"><span class="pre">id</span></tt> por medio de la función <tt class="docutils literal"><span class="pre">intval()</span></tt>, tu base de datos estaría en riesgo de un ataque de inyección <em>SQL</em>.</p>
<p>Otro importante problema es que cada archivo de controlador individual debe incluir al archivo <tt class="file docutils literal"><span class="pre">model.php</span></tt>. ¿Qué pasaría si cada archivo de controlador de repente tuviera que incluir un archivo adicional o realizar alguna tarea global (por ejemplo, reforzar la seguridad)?
Tal como está ahora, el código tendría que incluir todos los archivos de los controladores.
Si olvidas incluir algo en un solo archivo, esperemos que no sea alguno relacionado con la seguridad...</p>
</div>
<div class="section" id="el-controlador-frontal-al-rescate">
<h2>El «controlador frontal» al rescate<a class="headerlink" href="#el-controlador-frontal-al-rescate" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Una mucho mejor solución es usar un <a class="reference internal" href="../glossary.html#term-controlador-frontal"><em class="xref std std-term">controlador frontal</em></a>: un único archivo <em>PHP</em> a través del cual se procesen <em>todas</em> las peticiones. Con un controlador frontal, la <em>URI</em> de la aplicación cambia un poco, pero se vuelve más flexible:</p>
<div class="highlight-text"><div class="highlight"><pre>Sin controlador frontal
/index.php          =&gt; (ejecuta index.php) la página lista de mensajes.
/show.php           =&gt; (ejecuta show.php)  la página muestra un mensaje particular.

Con index.php como controlador frontal
/index.php          =&gt; (ejecuta index.php) la página lista de mensajes.
/index.php/show     =&gt; (ejecuta index.php) la página muestra un mensaje particular.
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Puedes quitar la porción <tt class="file docutils literal"><span class="pre">index.php</span></tt> de la <em>URI</em> si utilizas las reglas de reescritura de <em>Apache</em> (o equivalentes). En ese caso, la <em>URI</em> resultante de la página show del <em>blog</em> simplemente sería <tt class="docutils literal"><span class="pre">/show</span></tt>.</p>
</div>
<p>Cuando se usa un controlador frontal, un solo archivo <em>PHP</em> (<tt class="file docutils literal"><span class="pre">index.php</span></tt> en este caso) procesa todas las peticiones. Para la página <tt class="docutils literal"><span class="pre">show</span></tt> del <em>blog</em>, <tt class="docutils literal"><span class="pre">/index.php/show</span></tt> realmente ejecuta el archivo <tt class="file docutils literal"><span class="pre">index.php</span></tt>, que ahora es el responsable de dirigir internamente las peticiones basándose en la <em>URI</em> completa. Como puedes ver, un controlador frontal es una herramienta muy poderosa.</p>
<div class="section" id="creando-el-controlador-frontal">
<h3>Creando el controlador frontal<a class="headerlink" href="#creando-el-controlador-frontal" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Estás a punto de dar un <strong>gran</strong> paso en la aplicación. Con un archivo manejando todas las peticiones, puedes centralizar cosas tales como el manejo de la seguridad, la carga de configuración y enrutado. En esta aplicación, <tt class="file docutils literal"><span class="pre">index.php</span></tt> ahora debe ser lo suficientemente inteligente como para reproducir la lista de entradas del <em>blog</em> <em>o</em> mostrar la página de una entrada particular basándose en la <em>URI</em> solicitada:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>

<span class="c1">// carga e inicia algunas bibliotecas globales</span>
<span class="k">require_once</span> <span class="s1">&#39;model.php&#39;</span><span class="p">;</span>
<span class="k">require_once</span> <span class="s1">&#39;controllers.php&#39;</span><span class="p">;</span>

<span class="c1">// encamina la petición internamente</span>
<span class="nv">$uri</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;/index.php&#39;</span> <span class="o">==</span> <span class="nv">$uri</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">list_action</span><span class="p">();</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="s1">&#39;/index.php/show&#39;</span> <span class="o">==</span> <span class="nv">$uri</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nx">show_action</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Status: 404 Not Found&#39;</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s1">&#39;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Page Not Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Por organización, ambos controladores (antes <tt class="file docutils literal"><span class="pre">index.php</span></tt> y <tt class="file docutils literal"><span class="pre">show.php</span></tt>) son funciones <em>PHP</em> y cada una se ha movido a un archivo separado, <tt class="file docutils literal"><span class="pre">controllers.php</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">function</span> <span class="nf">list_action</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$posts</span> <span class="o">=</span> <span class="nx">get_all_posts</span><span class="p">();</span>
    <span class="k">require</span> <span class="s1">&#39;templates/list.php&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">show_action</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$post</span> <span class="o">=</span> <span class="nx">get_post_by_id</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
    <span class="k">require</span> <span class="s1">&#39;templates/show.php&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Como controlador frontal, <tt class="file docutils literal"><span class="pre">index.php</span></tt> ha asumido un papel completamente nuevo, el cual incluye la carga de las bibliotecas del núcleo y encaminar la aplicación para invocar a uno de los dos controladores (las funciones <tt class="docutils literal"><span class="pre">list_action()</span></tt> y <tt class="docutils literal"><span class="pre">show_action()</span></tt>). En realidad, el controlador frontal está empezando a verse y actuar como el mecanismo <em>Symfony2</em> para la manipulación y enrutado de peticiones.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Otra ventaja del controlador frontal es la flexibilidad de las <em>URL</em>. Ten en cuenta que la <em>URL</em> a la página <tt class="docutils literal"><span class="pre">show</span></tt> del <em>blog</em> se puede cambiar de <tt class="docutils literal"><span class="pre">/show</span></tt> a <tt class="docutils literal"><span class="pre">/read</span></tt> cambiando el código solamente en una única ubicación. Antes, era necesario cambiar todo un archivo para cambiar el nombre. En <em>Symfony2</em>, incluso las <em>URL</em> son más flexibles.</p>
</div>
<p>Por ahora, la aplicación ha evolucionado de un único archivo <em>PHP</em>, a una estructura organizada y permite la reutilización de código. Debes estar feliz, pero aún lejos de estar satisfecho. Por ejemplo, el sistema de «enrutado» es voluble, y no reconoce que la página <tt class="docutils literal"><span class="pre">list</span></tt> (<tt class="docutils literal"><span class="pre">/index.php</span></tt>) también debe ser accesible a través de <tt class="docutils literal"><span class="pre">/</span></tt> (si has agregado las reglas de reescritura de <em>Apache</em>). Además, en lugar de desarrollar el <em>blog</em>, una gran cantidad del tiempo se ha gastado trabajando en la «arquitectura» del código (por ejemplo, el enrutado, invocando controladores, plantillas, etc.) Se tendrá que gastar más tiempo para manejar el envío de formularios, validación de entradas, llevar la bitácora de sucesos y la seguridad.
¿Por qué tienes que reinventar soluciones a todos estos problemas rutinarios?</p>
</div>
<div class="section" id="anadiendo-un-toque-symfony2">
<h3>Añadiendo un toque <em>Symfony2</em><a class="headerlink" href="#anadiendo-un-toque-symfony2" title="Enlazar permanentemente con este título">¶</a></h3>
<p><em>Symfony2</em> al rescate. Antes de utilizar <em>Symfony2</em> realmente, necesitas descargarlo. Esto se puede hacer utilizando <tt class="docutils literal"><span class="pre">Composer</span></tt>, el cual cuida de descargar la versión
correcta con todas sus dependencias y proporciona un cargador automático. Un cargador automático es una herramienta que permite empezar a utilizar clases <em>PHP</em> sin incluir explícitamente el archivo que contiene la clase.</p>
<p>En tu directorio raíz crea un archivo de texto llamado <tt class="file docutils literal"><span class="pre">composer.json</span></tt> con el siguiente contenido:</p>
<div class="highlight-json"><pre>{
    "require": {
        "symfony/symfony": "2.2.*"
    },
    "autoload": {
        "files": ["model.php","controllers.php"]
    }
}</pre>
</div>
<p>Luego, <a class="reference external" href="http://getcomposer.org/download/">descarga Composer</a> y entonces ejecuta la siguiente orden, la cual descargará <em>Symfony</em> a un directorio <tt class="file docutils literal"><span class="pre">vendor/</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>php composer.phar install
</pre></div>
</div>
<p>Junto con la descarga de tus dependencias, <tt class="docutils literal"><span class="pre">Composer</span></tt> genera un archivo <tt class="file docutils literal"><span class="pre">vendor/autoload.php</span></tt>, el cual cuida de cargar automáticamente todos los archivos en la platafomra <em>Symfony</em> así como los archivos mencionados en la sección  <tt class="docutils literal"><span class="pre">autoload</span></tt> de tu <tt class="file docutils literal"><span class="pre">composer.json</span></tt>.</p>
<p>La esencia de la filosofía <em>Symfony</em> es la idea de que el trabajo principal de una aplicación es interpretar cada petición y devolver una respuesta. Con este fin, <em>Symfony2</em> proporciona ambas clases <tt class="xref php php-class docutils literal"><span class="pre">Symfony\Component\HttpFoundation\Request</span></tt> y <tt class="xref php php-class docutils literal"><span class="pre">Symfony\Component\HttpFoundation\Response</span></tt>. Estas clases son representaciones orientadas a objetos de la petición <em>HTTP</em> que se está procesando y la respuesta <em>HTTP</em> que devolverá. Úsalas para mejorar el <em>blog</em>:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>
<span class="k">require_once</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">createFromGlobals</span><span class="p">();</span>

<span class="nv">$uri</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getPathInfo</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">==</span> <span class="nv">$uri</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nx">list_action</span><span class="p">();</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="s1">&#39;/show&#39;</span> <span class="o">==</span> <span class="nv">$uri</span> <span class="o">&amp;&amp;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nx">show_action</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$html</span> <span class="o">=</span> <span class="s1">&#39;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Page Not Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">;</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nv">$html</span><span class="p">,</span> <span class="mi">404</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// difunde las cabeceras y envía la respuesta</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</pre></div>
</div>
<p>Los controladores son responsables de devolver un objeto <tt class="docutils literal"><span class="pre">Respuesta</span></tt>.
Para facilitarnos esto, puedes agregar una nueva función <tt class="docutils literal"><span class="pre">render_template()</span></tt>, la cual, por cierto, actúa un poco como el motor de plantillas de <em>Symfony2</em>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// controllers.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">list_action</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$posts</span> <span class="o">=</span> <span class="nx">get_all_posts</span><span class="p">();</span>
    <span class="nv">$html</span> <span class="o">=</span> <span class="nx">render_template</span><span class="p">(</span><span class="s1">&#39;templates/list.php&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span> <span class="o">=&gt;</span> <span class="nv">$posts</span><span class="p">));</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nv">$html</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">show_action</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$post</span> <span class="o">=</span> <span class="nx">get_post_by_id</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
    <span class="nv">$html</span> <span class="o">=</span> <span class="nx">render_template</span><span class="p">(</span><span class="s1">&#39;templates/show.php&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;post&#39;</span> <span class="o">=&gt;</span> <span class="nv">$post</span><span class="p">));</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nv">$html</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// función ayudante para reproducir plantillas</span>
<span class="k">function</span> <span class="nf">render_template</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nb">extract</span><span class="p">(</span><span class="nv">$args</span><span class="p">);</span>
    <span class="nb">ob_start</span><span class="p">();</span>
    <span class="k">require</span> <span class="nv">$path</span><span class="p">;</span>
    <span class="nv">$html</span> <span class="o">=</span> <span class="nb">ob_get_clean</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$html</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Al reunir una pequeña parte de <em>Symfony2</em>, la aplicación es más flexible y fiable. La <tt class="docutils literal"><span class="pre">Petición</span></tt> proporciona una manera confiable para acceder a información de la petición <em>HTTP</em>. Especialmente, el método <tt class="docutils literal"><span class="pre">getPathInfo()</span></tt> devuelve una <em>URI</em> limpia (siempre devolviendo <tt class="docutils literal"><span class="pre">/show</span></tt> y nunca <tt class="docutils literal"><span class="pre">/index.php/show</span></tt>).
Por lo tanto, incluso si el usuario va a <tt class="docutils literal"><span class="pre">/index.php/show</span></tt>, la aplicación es lo suficientemente inteligente para encaminar la petición hacia <tt class="docutils literal"><span class="pre">show_action()</span></tt>.</p>
<p>El objeto <tt class="docutils literal"><span class="pre">Respuesta</span></tt> proporciona flexibilidad al construir la respuesta <em>HTTP</em>, permitiendo que las cabeceras <em>HTTP</em> y el contenido se agreguen a través de una interfaz orientada a objetos.
Y aunque las respuestas en esta aplicación son simples, esta flexibilidad pagará dividendos en cuanto tu aplicación crezca.</p>
</div>
<div class="section" id="aplicacion-de-ejemplo-en-symfony2">
<h3>Aplicación de ejemplo en <em>Symfony2</em><a class="headerlink" href="#aplicacion-de-ejemplo-en-symfony2" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El <em>blog</em> ha <em>avanzado</em>, pero todavía contiene una gran cantidad de código para una aplicación tan simple. De paso, también inventamos un sencillo sistema de enrutado y un método utilizando <tt class="docutils literal"><span class="pre">ob_start()</span></tt> y <tt class="docutils literal"><span class="pre">ob_get_clean()</span></tt> para procesar plantillas. Si por alguna razón, necesitas continuar la construcción de esta «plataforma» desde cero, por lo menos puedes usar los componentes independientes <a class="reference external" href="https://github.com/symfony/Routing">Routing</a> y <a class="reference external" href="https://github.com/symfony/Templating">Templating</a> de <em>Symfony</em>, que resuelven estos problemas.</p>
<p>En lugar de volver a solucionar problemas comunes, puedes dejar que <em>Symfony2</em> se preocupe de ellos por ti. Aquí está la misma aplicación de ejemplo, ahora construida en <em>Symfony2</em>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/BlogBundle/Controller/BlogController.php</span>
<span class="k">namespace</span> <span class="nx">Acme\BlogBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BlogController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">listAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$posts</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;doctrine&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getManager</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT p FROM AcmeBlogBundle:Post p&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span>
            <span class="s1">&#39;AcmeBlogBundle:Blog:list.html.php&#39;</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span> <span class="o">=&gt;</span> <span class="nv">$posts</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$post</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;doctrine&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">getManager</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;AcmeBlogBundle:Post&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
        <span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$post</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// provoca que se muestre la página de error 404</span>
            <span class="k">throw</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createNotFoundException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span>
            <span class="s1">&#39;AcmeBlogBundle:Blog:show.html.php&#39;</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;post&#39;</span> <span class="o">=&gt;</span> <span class="nv">$post</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Los dos controladores siguen siendo ligeros. Cada uno utiliza la <a class="reference internal" href="doctrine.html"><em>biblioteca ORM de Doctrine</em></a> para recuperar objetos de la base de datos y el componente <tt class="docutils literal"><span class="pre">Templating</span></tt> para reproducir una plantilla y devolver un objeto <tt class="docutils literal"><span class="pre">Respuesta</span></tt>. La plantilla <tt class="docutils literal"><span class="pre">list</span></tt> ahora es un poco más simple:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/views/Blog/list.html.php --&gt;</span>
<span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;::layout.html.php&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;slots&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;List of Posts&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>

<span class="nt">&lt;h1&gt;</span>List of Posts<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;ul&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$posts</span> <span class="k">as</span> <span class="nv">$post</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;li&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;router&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span>
            <span class="s1">&#39;blog_show&#39;</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">())</span>
        <span class="p">)</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">getTitle</span><span class="p">()</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</div>
<p>El diseño es casi idéntico:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="c">&lt;!-- app/Resources/views/layout.html.php --&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
    <span class="nt">&lt;html&gt;</span>
        <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;slots&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span>
            <span class="s1">&#39;title&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Default title&#39;</span>
        <span class="p">)</span> <span class="cp">?&gt;</span><span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;/head&gt;</span>
        <span class="nt">&lt;body&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;slots&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">&#39;_content&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Te vamos a dejar como ejercicio la plantilla <tt class="docutils literal"><span class="pre">show</span></tt>, porque debería ser trivial crearla basándote en la plantilla <tt class="docutils literal"><span class="pre">list</span></tt>.</p>
</div>
<p>Cuando arranca el motor <em>Symfony2</em> (conocido como el <tt class="docutils literal"><span class="pre">núcleo</span></tt>), necesita un mapa para saber qué controladores ejecutar basándose en la información solicitada.
Un mapa de configuración de enrutado proporciona esta información en formato legible:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/routing.yml</span>
<span class="l-Scalar-Plain">blog_list</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span>     <span class="l-Scalar-Plain">/blog</span>
    <span class="l-Scalar-Plain">defaults</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">_controller</span><span class="p-Indicator">:</span> <span class="nv">AcmeBlogBundle</span><span class="p-Indicator">:</span><span class="nv">Blog</span><span class="p-Indicator">:</span><span class="nv">list</span> <span class="p-Indicator">}</span>

<span class="l-Scalar-Plain">blog_show</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span>     <span class="l-Scalar-Plain">/blog/show/{id}</span>
    <span class="l-Scalar-Plain">defaults</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">_controller</span><span class="p-Indicator">:</span> <span class="nv">AcmeBlogBundle</span><span class="p-Indicator">:</span><span class="nv">Blog</span><span class="p-Indicator">:</span><span class="nv">show</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
<p>Ahora que <em>Symfony2</em> se encarga de todas las tareas rutinarias, el controlador frontal es muy simple. Y debido a que hace tan poco, nunca tienes que volver a tocarlo una vez creado (y si utilizas una distribución <em>Symfony2</em>, ¡ni siquiera tendrás que crearlo!):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// web/app.php</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../app/bootstrap.php&#39;</span><span class="p">;</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../app/AppKernel.php&#39;</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nv">$kernel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppKernel</span><span class="p">(</span><span class="s1">&#39;prod&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="nv">$kernel</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="na">createFromGlobals</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</pre></div>
</div>
<p>El único trabajo del controlador frontal es iniciar el motor de <em>Symfony2</em> (<tt class="docutils literal"><span class="pre">núcleo</span></tt>) y pasarle un objeto <tt class="docutils literal"><span class="pre">Petición</span></tt> para que lo manipule. El núcleo de <em>Symfony2</em> entonces utiliza el mapa de enrutado para determinar qué controlador invocar. Al igual que antes, el método controlador es el responsable de devolver el objeto <tt class="docutils literal"><span class="pre">Respuesta</span></tt> final.
Realmente no hay mucho más sobre él.</p>
<p>Para conseguir una representación visual de cómo maneja <em>Symfony2</em> cada petición, consulta el <a class="reference internal" href="http_fundamentals.html#request-flow-figure"><em>diagrama de flujo de la petición</em></a>.</p>
</div>
<div class="section" id="que-mas-ofrece-symfony2">
<h3>Qué más ofrece <em>Symfony2</em><a class="headerlink" href="#que-mas-ofrece-symfony2" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En los siguientes capítulos, aprenderás más acerca de cómo funciona cada pieza de <em>Symfony</em> y la organización recomendada de un proyecto. Por ahora, vamos a ver cómo, migrar el <em>blog</em> de <em>PHP</em> simple a <em>Symfony2</em> nos ha mejorado la vida:</p>
<ul class="simple">
<li>Tu aplicación cuenta con <strong>código claro y organizado consistentemente</strong> (aunque <em>Symfony</em> no te obliga a ello). Este promueve la <strong>reutilización</strong> y permite a los nuevos desarrolladores ser productivos en el proyecto con mayor rapidez.</li>
<li>100% del código que escribes es para <em>tu</em> aplicación. <strong>No necesitas desarrollar o mantener servicios públicos de bajo nivel</strong> tal como la <a class="reference internal" href="page_creation.html#autoloading-introduction-sidebar"><em>carga automática</em></a> de clases, el <a class="reference internal" href="routing.html"><em>enrutado</em></a> o la reproducción de <a class="reference internal" href="controller.html"><em>controladores</em></a>;</li>
<li><em>Symfony2</em> te proporciona <strong>acceso a herramientas de código abierto</strong> tal como <em>Doctrine</em>, plantillas, seguridad, formularios, validación y componentes de traducción (por nombrar algunos);</li>
<li>La aplicación ahora disfruta de <strong>direcciones URL totalmente flexibles</strong> gracias al componente <tt class="docutils literal"><span class="pre">Routing</span></tt>;</li>
<li>La arquitectura centrada en <em>HTTP</em> de <em>Symfony2</em> te da acceso a poderosas herramientas, tal como la <strong>memoria caché HTTP</strong> impulsadas por la <strong>caché HTTP interna de Symfony2</strong> o herramientas más poderosas, tales como <a class="reference external" href="https://www.varnish-cache.org/">Varnish</a>. Esto se trata posteriormente en el capítulo «<a class="reference internal" href="http_cache.html"><em>todo sobre caché</em></a>».</li>
</ul>
<p>Y lo mejor de todo, utilizando <em>Symfony2</em>, ¡ahora tienes acceso a un conjunto de herramientas de <strong>código abierto de alta calidad desarrolladas por la comunidad Symfony2</strong>!
Puedes encontrar una buena colección de herramientas comunitarias de <em>Symfony2</em> en <a class="reference external" href="http://knpbundles.com/">KnpBundles.com</a>.</p>
</div>
</div>
<div class="section" id="mejores-plantillas">
<h2>Mejores plantillas<a class="headerlink" href="#mejores-plantillas" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Si decides utilizarlo, <em>Symfony2</em> de serie viene con un motor de plantillas llamado <a class="reference external" href="http://gitnacho.github.com/symfony-docs-es/twig/index.html">Twig</a> el cual hace que las plantillas se escriban más rápido y sean más fáciles de leer.
Esto significa que, incluso, ¡la aplicación de ejemplo podría contener mucho menos código! Toma por ejemplo, la plantilla <tt class="docutils literal"><span class="pre">list</span></tt> escrita en <em>Twig</em>:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="c">{# src/Acme/BlogBundle/Resources/views/Blog/list.html.twig #}</span>
<span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;::layout.html.twig&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>List of Posts<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
    <span class="nt">&lt;h1&gt;</span>List of Posts<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">posts</span> <span class="cp">%}</span>
        <span class="nt">&lt;li&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">path</span><span class="o">(</span><span class="s1">&#39;blog_show&#39;</span><span class="o">,</span> <span class="o">{</span><span class="s1">&#39;id&#39;</span><span class="o">:</span> <span class="nv">post.id</span><span class="o">})</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                <span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span>
                <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>También es fácil escribir la plantilla <tt class="docutils literal"><span class="pre">layout.html.twig</span></tt> correspondiente:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="c">{# app/Resources/views/layout.html.twig #}</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
    <span class="nt">&lt;html&gt;</span>
        <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Default title<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;/head&gt;</span>
        <span class="nt">&lt;body&gt;</span>
        <span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p><em>Twig</em> es compatible con <em>Symfony2</em>. Y si bien, las plantillas <em>PHP</em> siempre contarán con el apoyo de <em>Symfony2</em>, vamos a seguir explicando muchas de las ventajas de <em>Twig</em>. Para más información, consulta el capítulo <a class="reference internal" href="templating.html"><em>Plantillas</em></a>.</p>
</div>
<div class="section" id="aprende-mas-en-el-recetario">
<h2>Aprende más en el recetario<a class="headerlink" href="#aprende-mas-en-el-recetario" title="Enlazar permanentemente con este título">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../cookbook/templating/PHP.html"><em>Cómo usar plantillas PHP en lugar de Twig</em></a></li>
<li><a class="reference internal" href="../cookbook/controller/service.html"><em>Cómo definir controladores como servicios</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <a href="https://github.com/symfony/symfony-standard"><img style="position: fixed; top: 0; right: 0; border: 0;" src="http://gitnacho.github.com/tnp/img/comun/bifurcame.png" alt="Bifúrcame en GitHub" /></a>
  
  <div style="width:740px;margin:10px auto;">
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="installation.html" title="Instalando y configurando Symfony"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="http_fundamentals.html" title="Symfony2 y fundamentos HTTP"
             >anterior</a> |</li>
        <li><a href="../index.html">en Español</a> &raquo;</li>
          <li><a href="index.html" >Libro</a> &raquo;</li> 
      </ul>
    </div>
  </div>


   <div style="width: 740px; margin: 0 auto;">
     <div id="disqus_thread"></div>
     
    <div class="footer">
        &copy; Copyright 2011-2013, Traducido por Nacho Pacheco.
      Actualizado por última vez en Mar 19, 2013.
      Creado con <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
   </div>
   <script type="text/javascript">
    var disqus_shortname = 'documentos-mx';
    var disqus_developer = 1;
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
   </script>
   <noscript>
     Por favor activa JavaScript para ver los <a href="http://disqus.com/?ref_noscript">comentarios accionados por Disqus.</a>
   </noscript>

  </body>
</html>