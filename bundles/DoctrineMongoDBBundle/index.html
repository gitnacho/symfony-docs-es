
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DoctrineMongoDBBundle &mdash; Manual de Symfony2 en Español</title>
    
    <link rel="stylesheet" href="../../_static/tnp.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0.14',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="shortcut icon" href="../../_static/icotnp.ico"/>
    <link rel="top" title="Manual de Symfony2 en Español" href="../../index.html" />
    <link rel="up" title="Paquetes de la edición estándar de Symfony" href="../index.html" />
    <link rel="next" title="Configurando DoctrineMongoDBBundle" href="config.html" />
    <link rel="prev" title="DoctrineMigrationsBundle" href="../DoctrineMigrationsBundle/index.html" /> 
  </head>
  <body>
  <div class="imalogo">
    
  <a href="../../index.html"><img src="http://gitnacho.github.com/tnp/img/sf/logo-big.gif" alt="Edición estándar de Symfony2" />
  
    <a href="http://gitnacho.github.com/tnp/"><img src="http://gitnacho.github.com/tnp/_static/normaltnp.png" alt="Traducciones de Nacho Pacheco" /></a>
    <div class="social">
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="esymfony" data-lang="es">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
    <div id="searchbox">
      <form class="searc " action="../../search.html" method="get">
      <input type="search" name="q" placeholder="Término a buscar" />
      <input type="submit" value="Ir" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
    

    
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="config.html" title="Configurando DoctrineMongoDBBundle"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="../DoctrineMigrationsBundle/index.html" title="DoctrineMigrationsBundle"
             accesskey="P">anterior</a> |</li>
        <li><a href="../../index.html">en Español</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Paquetes de la edición estándar de <em>Symfony</em></a> &raquo;</li> 
      </ul>
    </div>
  </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="doctrinemongodbbundle">
<h1><tt class="docutils literal"><span class="pre">DoctrineMongoDBBundle</span></tt><a class="headerlink" href="#doctrinemongodbbundle" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>El asignador de objeto a documento <a class="reference external" href="http://www.mongodb.org/">MongoDB</a> (<em>ODM</em> por Object Document Mapper) es muy similar al <em>ORM</em> de <em>Doctrine2</em> en su filosofía y funcionamiento. En otras palabras, similar al <a class="reference internal" href="../../book/doctrine.html"><em>ORM de Doctrine2</em></a>, con el <em>ODM</em> de <em>Doctrine</em>, sólo tratas con objetos <em>PHP</em> simples, los cuales luego se persisten de forma transparente hacia y desde <em>MongoDB</em>.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Puedes leer más acerca del <em>ODM</em> de <em>Doctrine MongoDB</em> en la <a class="reference external" href="http://www.doctrine-project.org/docs/mongodb_odm/1.0/en">documentación</a> del proyecto.</p>
</div>
<p>Está disponible el paquete que integra el <em>ODM MongoDB de Doctrine</em> en <em>Symfony</em>, por lo tanto es fácil configurarlo y usarlo.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Este capítulo lo debes de sentir muy parecido al capítulo <a class="reference internal" href="../../book/doctrine.html"><em>ORM de Doctrine2</em></a>, que habla de cómo puedes utilizar el <em>ORM</em> de <em>Doctrine</em> para guardar los datos en bases de datos relacionales (por ejemplo, <em>MySQL</em>). Esto es a propósito &#8212; si persistes en una base de datos relacional por medio del <em>ORM</em> o a través del <em>ODM MongoDB</em>, las filosofías son muy parecidas.</p>
</div>
<div class="section" id="instalando">
<h2>Instalando<a class="headerlink" href="#instalando" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para utilizar el <em>ODM MongoDB</em>, necesitarás dos bibliotecas proporcionadas por <em>Doctrine</em> y un paquete que las integra en <em>Symfony</em>.</p>
<div class="section" id="instalando-el-paquete-con-composer">
<h3>Instalando el paquete con <tt class="docutils literal"><span class="pre">Composer</span></tt><a class="headerlink" href="#instalando-el-paquete-con-composer" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para instalar <tt class="docutils literal"><span class="pre">DoctrineMongoDBBundle</span></tt> con <tt class="docutils literal"><span class="pre">Composer</span></tt> sólo tienes que añadir lo siguiente a tu archivo `` <tt class="file docutils literal"><span class="pre">composer.json</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="p">{</span>
    <span class="k">require</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;doctrine/mongodb-odm-bundle&quot;</span><span class="o">:</span> <span class="s2">&quot;dev-master&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Luego, puedes instalar las nuevas dependencias ejecutando la orden <tt class="docutils literal"><span class="pre">update</span></tt> de <tt class="docutils literal"><span class="pre">Composer</span></tt> desde el directorio donde se encuentra el archivo <tt class="docutils literal"><span class="pre">composer.json</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre>php composer.phar update
</pre></div>
</div>
<p>Ahora, <tt class="docutils literal"><span class="pre">Composer</span></tt> automáticamente descargará todos los archivos necesarios y los instalará por ti.</p>
</div>
<div class="section" id="registrando-las-anotaciones-y-el-paquete">
<h3>Registrando las anotaciones y el paquete<a class="headerlink" href="#registrando-las-anotaciones-y-el-paquete" title="Enlazar permanentemente con este título">¶</a></h3>
<p>A continuación, registra la biblioteca de anotaciones añadiendo las siguientes acciones al cargador (debajo de la línea <tt class="docutils literal"><span class="pre">AnnotationRegistry::registerFile</span></tt> existente):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/autoload.php</span>
<span class="nx">AnnotationRegistry</span><span class="o">::</span><span class="na">registerFile</span><span class="p">(</span>
    <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../vendor/doctrine/mongodb-odm/lib/Doctrine/ODM/MongoDB/Mapping/Annotations/DoctrineAnnotations.php&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Todo lo que resta por hacer es actualizar tu archivo <tt class="file docutils literal"><span class="pre">AppKernel.php</span></tt>, y registrar el nuevo paquete:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/AppKernel.php</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">registerBundles</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$bundles</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="c1">// ...</span>
        <span class="k">new</span> <span class="nx">Doctrine\Bundle\MongoDBBundle\DoctrineMongoDBBundle</span><span class="p">(),</span>
    <span class="p">);</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>¡Enhorabuena! Estás listo para empezar a trabajar.</p>
</div>
</div>
<div class="section" id="configurando">
<h2>Configurando<a class="headerlink" href="#configurando" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para empezar, necesitarás una estructura básica que configure el gestor de documentos. La forma más fácil es habilitar el <tt class="docutils literal"><span class="pre">auto_mapping</span></tt>, el cual activará al <em>ODM MongoDB</em> a través de tu aplicación:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">doctrine_mongodb</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">connections</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">server</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">mongodb://localhost:27017</span>
            <span class="l-Scalar-Plain">options</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">connect</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
    <span class="l-Scalar-Plain">default_database</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">test_database</span>
    <span class="l-Scalar-Plain">document_managers</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">auto_mapping</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Por supuesto, también te tienes que asegurar de que el servidor <em>MongoDB</em> se ejecute en segundo plano. Para más información, consulta la <a class="reference external" href="http://www.mongodb.org/display/DOCS/Quickstart">Guía de inicio rápido</a> de <em>MongoDB</em>.</p>
</div>
</div>
<div class="section" id="un-sencillo-ejemplo-un-producto">
<h2>Un sencillo ejemplo: Un producto<a class="headerlink" href="#un-sencillo-ejemplo-un-producto" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La mejor manera de entender el <em>ODM</em> de <em>Doctrine MongoDB</em> es verlo en acción.
En esta sección, recorreremos cada paso necesario para empezar a persistir documentos hacia y desde <em>MongoDB</em>.</p>
<div class="sidebar">
<p class="first sidebar-title">El código del ejemplo</p>
<p>Si quieres seguir el ejemplo de este capítulo, crea el paquete <tt class="docutils literal"><span class="pre">AcmeStoreBundle</span></tt> ejecutando la orden:</p>
<div class="last highlight-bash"><div class="highlight"><pre>php app/console generate:bundle --namespace<span class="o">=</span>Acme/StoreBundle
</pre></div>
</div>
</div>
<div class="section" id="creando-una-clase-documento">
<h3>Creando una clase Documento<a class="headerlink" href="#creando-una-clase-documento" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Supongamos que estás construyendo una aplicación donde necesitas mostrar tus productos.
Sin siquiera pensar en <em>Doctrine</em> o <em>MongoDB</em>, ya sabes que necesitas un objeto <tt class="docutils literal"><span class="pre">Producto</span></tt> para representar los productos. Crea esta clase en el directorio <tt class="docutils literal"><span class="pre">Document</span></tt> de tu <tt class="docutils literal"><span class="pre">AcmeStoreBundle</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/StoreBundle/Document/Product.php</span>
<span class="k">namespace</span> <span class="nx">Acme\StoreBundle\Document</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Product</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$price</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La clase &#8212; a menudo llamada &#8220;documento&#8221;, es decir, <em>una clase básica que contiene los datos</em> &#8212; es simple y ayuda a cumplir con el requisito del negocio de que tu aplicación necesita productos. Esta clase, todavía no se puede persistir a <em>Doctrine MongoDB</em> &#8212; es sólo una clase <em>PHP</em> simple.</p>
</div>
<div class="section" id="agregando-informacion-de-asignacion">
<h3>Agregando información de asignación<a class="headerlink" href="#agregando-informacion-de-asignacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p><em>Doctrine</em> te permite trabajar con <em>MongoDB</em> de una manera mucho más interesante que solo recuperar datos de un lado a otro como una matriz. En cambio, <em>Doctrine</em> te permite persistir <em>objetos</em> completos a <em>MongoDB</em> y recuperar objetos enteros desde <em>MongoDB</em>. Esto funciona asignando una clase <em>PHP</em> y sus propiedades a las entradas de una colección <em>MongoDB</em>.</p>
<p>Para que <em>Doctrine</em> sea capaz de hacer esto, sólo tienes que crear &#8220;metadatos&#8221;, o la configuración que le dice a <em>Doctrine</em> exactamente cómo se deben <em>asignar</em> a <em>MongoDB</em> la clase <tt class="docutils literal"><span class="pre">Producto</span></tt> y sus propiedades. Estos metadatos se pueden especificar en una variedad de formatos diferentes, incluyendo <em>YAML</em>, <em>XML</em> o directamente dentro de la clase <tt class="docutils literal"><span class="pre">Producto</span></tt> a través de anotaciones:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Annotations</em><div class="highlight-php-annotations"><div class="highlight"><pre><span class="c1">// src/Acme/StoreBundle/Document/Product.php</span>
<span class="k">namespace</span> <span class="nx">Acme\StoreBundle\Document</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\ODM\MongoDB\Mapping\Annotations</span> <span class="k">as</span> <span class="nx">MongoDB</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @MongoDB\Document</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Product</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @MongoDB\Id</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @MongoDB\String</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @MongoDB\Float</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$price</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/StoreBundle/Resources/config/doctrine/Product.mongodb.yml</span>
<span class="l-Scalar-Plain">Acme\StoreBundle\Document\Product</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">fields</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">true</span>
        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
        <span class="l-Scalar-Plain">price</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">float</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><pre>&lt;!-- src/Acme/StoreBundle/Resources/config/doctrine/Product.mongodb.xml --&gt;
&lt;doctrine-mongo-mapping xmlns="http://doctrine-project.org/schemas/odm/doctrine-mongo-mapping"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://doctrine-project.org/schemas/odm/doctrine-mongo-mapping
                    http://doctrine-project.org/schemas/odm/doctrine-mongo-mapping.xsd"&gt;

    &lt;documenté name="Acme\StoreBundle\Document\Product"&gt;
        &lt;field fieldName="id" id="true" /&gt;
        &lt;field fieldName="name" type="string" /&gt;
        &lt;field fieldName="price" type="float" /&gt;
    &lt;/document&gt;
&lt;/doctrine-mongo-mapping&gt;</pre>
</div>
</li>
</ul>
</div>
<p><em>Doctrine</em> te permite elegir entre una amplia variedad de tipos de campo diferentes, cada uno con sus propias opciones. Para más información sobre los tipos de campo disponibles, consulta la sección <a class="reference internal" href="#cb-mongodb-field-types"><em>Referencia de tipos de campo Doctrine</em></a>.</p>
<div class="admonition-ver-tambien admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last">También puedes consultar la <a class="reference external" href="http://www.doctrine-project.org/docs/mongodb_odm/1.0/en/reference/basic-mapping.html">Documentación de asignación básica</a> de <em>Doctrine</em> para todos los detalles sobre la información de asignación. Si utilizas anotaciones, tendrás que prefijar todas tus anotaciones con <tt class="docutils literal"><span class="pre">MongoDB\</span></tt> (por ejemplo, <tt class="docutils literal"><span class="pre">MongoDB\Cadena</span></tt>), lo cual no se muestra en la documentación de <em>Doctrine</em>. También tendrás que incluir la declaración <tt class="docutils literal"><span class="pre">use</span> <span class="pre">Doctrine\ODM\MongoDB\Mapping\Annotations</span> <span class="pre">as</span> <span class="pre">MongoDB;</span></tt>, la cual <em>importa</em> el prefijo <tt class="docutils literal"><span class="pre">MongoDB</span></tt> para las anotaciones.</p>
</div>
</div>
<div class="section" id="generando-captadores-y-definidores">
<h3>Generando captadores y definidores<a class="headerlink" href="#generando-captadores-y-definidores" title="Enlazar permanentemente con este título">¶</a></h3>
<p>A pesar de que <em>Doctrine</em> ya sabe cómo persistir un objeto <tt class="docutils literal"><span class="pre">Producto</span></tt> a <em>MongoDB</em>, la clase en sí en realidad todavía no es útil. Puesto que <tt class="docutils literal"><span class="pre">Producto</span></tt> es sólo una clase <em>PHP</em> regular, es necesario crear métodos captadores y definidores (por ejemplo, <tt class="docutils literal"><span class="pre">getNombre()</span></tt>, <tt class="docutils literal"><span class="pre">setNombre()</span></tt>) para poder acceder a sus propiedades (ya que las propiedades son <tt class="docutils literal"><span class="pre">protegidas</span></tt>). Afortunadamente, <em>Doctrine</em> puede hacer esto por ti con la siguiente orden:</p>
<div class="highlight-bash"><div class="highlight"><pre>php app/console doctrine:mongodb:generate:documents AcmeStoreBundle
</pre></div>
</div>
<p>Esta orden se asegura de que se generen todos los captadores y definidores para la clase <tt class="docutils literal"><span class="pre">Producto</span></tt>. Esta es una orden segura &#8212; la puedes ejecutar una y otra vez: sólo genera captadores y definidores que no existen (es decir, no sustituye métodos existentes).</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">A <em>Doctrine</em> no le importa si tus propiedades son <tt class="docutils literal"><span class="pre">protegidas</span></tt> o <tt class="docutils literal"><span class="pre">privadas</span></tt>, o si una propiedad tiene o no una función captadora o definidora.
Aquí, los captadores y definidores se generan sólo porque los necesitarás para interactuar con tu objeto <em>PHP</em>.</p>
</div>
</div>
<div class="section" id="persistiendo-objetos-a-mongodb">
<h3>Persistiendo objetos a <em>MongoDB</em><a class="headerlink" href="#persistiendo-objetos-a-mongodb" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Ahora que tienes asignado un documento <tt class="docutils literal"><span class="pre">Producto</span></tt> completo, con métodos captadores y definidores, estás listo para persistir los datos a <em>MongoDB</em>. Desde el interior de un controlador, esto es bastante fácil. Agrega el siguiente método al <tt class="docutils literal"><span class="pre">DefaultController</span></tt> del paquete:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// src/Acme/StoreBundle/Controller/DefaultController.php</span>
<span class="k">use</span> <span class="nx">Acme\StoreBundle\Document\Product</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">createAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$product</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Product</span><span class="p">();</span>
    <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;A Foo Bar&#39;</span><span class="p">);</span>
    <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">setPrice</span><span class="p">(</span><span class="s1">&#39;19.99&#39;</span><span class="p">);</span>

    <span class="nv">$dm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;doctrine.odm.mongodb.document_manager&#39;</span><span class="p">);</span>
    <span class="nv">$dm</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$product</span><span class="p">);</span>
    <span class="nv">$dm</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Created product id &#39;</span><span class="o">.</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si estás siguiendo este ejemplo, tendrás que crear una ruta que apunte a esta acción para verla trabajar.</p>
</div>
<p>Vamos a recorrer este ejemplo:</p>
<ul class="simple">
<li><strong>Líneas 8-10</strong> En esta sección, creas una instancia y trabajas con el objeto <tt class="docutils literal"><span class="pre">$product</span></tt> como cualquier otro objeto <em>PHP</em> normal;</li>
<li><strong>Línea 12</strong> Esta línea recupera el objeto <em>gestor de documentos</em>, el cual es responsable de manejar el proceso de persistir y recuperar objetos hacia y desde <em>MongoDB</em>;</li>
<li><strong>Línea 13</strong> El método <tt class="docutils literal"><span class="pre">persist()</span></tt> dice a <em>Doctrine</em> que &#8220;procese&#8221; el objeto <tt class="docutils literal"><span class="pre">$product</span></tt>. Esto en realidad no resulta en una consulta que se deba hacer a <em>MongoDB</em> (todavía).</li>
<li><strong>Línea 14</strong> Cuando se llama al método <tt class="docutils literal"><span class="pre">flush()</span></tt>, <em>Doctrine</em> mira todos los objetos que está gestionando para ver si es necesario persistirlos a <em>MongoDB</em>. En este ejemplo, el objeto <tt class="docutils literal"><span class="pre">$product</span></tt> aún no se ha persistido, por lo que el gestor de documentos hace una consulta a <em>MongoDB</em>, la cual añade una nueva entrada.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">De hecho, ya que <em>Doctrine</em> está consciente de todos los objetos gestionados, cuando llamas al método <tt class="docutils literal"><span class="pre">flush()</span></tt>, se calcula un conjunto de cambios y ejecuta la operación más eficiente posible.</p>
</div>
<p>Al crear o actualizar objetos, el flujo de trabajo siempre es el mismo. En la siguiente sección, verás cómo <em>Doctrine</em> es lo suficientemente inteligente como para actualizar las entradas, si ya existen en <em>MongoDB</em>.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last"><em>Doctrine</em> proporciona una biblioteca que te permite cargar en tu proyecto mediante programación los datos de prueba (es decir, &#8220;datos accesorios&#8221;). Para más información, consulta <a class="reference internal" href="../DoctrineFixturesBundle/index.html"><em>DoctrineFixturesBundle</em></a>.</p>
</div>
</div>
<div class="section" id="recuperando-objetos-desde-mongodb">
<h3>Recuperando objetos desde <em>MongoDB</em><a class="headerlink" href="#recuperando-objetos-desde-mongodb" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Recuperar un objeto de <em>MongoDB</em> incluso es más fácil. Por ejemplo, supongamos que has configurado una ruta para mostrar un <tt class="docutils literal"><span class="pre">Producto</span></tt> específico en función del valor de su <tt class="docutils literal"><span class="pre">id</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$product</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;doctrine.odm.mongodb.document_manager&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;AcmeStoreBundle:Product&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createNotFoundException</span><span class="p">(</span><span class="s1">&#39;No product found for id &#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// haz algo, como pasar el objeto $product a una plantilla</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Al consultar por un determinado tipo de objeto, siempre utilizas lo que se conoce como &#8220;repositorio&#8221;. Puedes pensar en un repositorio como una clase <em>PHP</em>, cuyo único trabajo consiste en ayudarte a buscar los objetos de una determinada clase. Puedes acceder al objeto repositorio de una clase documento vía:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$repository</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;doctrine.odm.mongodb.document_manager&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;AcmeStoreBundle:Product&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">La cadena <tt class="docutils literal"><span class="pre">AcmeStoreBundle:Product</span></tt> es un método abreviado que puedes utilizar en cualquier lugar de <em>Doctrine</em> en lugar del nombre de clase completo de la entidad (es decir, <tt class="docutils literal"><span class="pre">Acme\StoreBundle\Entity\Product</span></tt>).
Mientras tu documento viva en el espacio de nombres <tt class="docutils literal"><span class="pre">Document</span></tt> de tu paquete, esto va a funcionar.</p>
</div>
<p>Una vez que tengas tu repositorio, tienes acceso a todo tipo de útiles métodos:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// consulta por la clave principal (generalmente &quot;id&quot;)</span>
<span class="nv">$product</span> <span class="o">=</span> <span class="nv">$repository</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

<span class="c1">// nombres de método dinámicos para búsquedas basadas en</span>
<span class="c1">// el valor de una columna</span>
<span class="nv">$product</span> <span class="o">=</span> <span class="nv">$repository</span><span class="o">-&gt;</span><span class="na">findOneById</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="nv">$product</span> <span class="o">=</span> <span class="nv">$repository</span><span class="o">-&gt;</span><span class="na">findOneByName</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="c1">// recupera TODOS los productos</span>
<span class="nv">$products</span> <span class="o">=</span> <span class="nv">$repository</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>

<span class="c1">// busca un grupo de productos basándose en el</span>
<span class="c1">// valor de una columna arbitraria</span>
<span class="nv">$products</span> <span class="o">=</span> <span class="nv">$repository</span><span class="o">-&gt;</span><span class="na">findByPrice</span><span class="p">(</span><span class="mf">19.99</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Por supuesto, también puedes realizar consultas complejas, acerca de las cuales aprenderás más en la sección <a class="reference internal" href="../../book/doctrine.html#book-doctrine-queries"><em>Consultando por objetos</em></a>.</p>
</div>
<p>También puedes tomar ventaja de los útiles métodos <tt class="docutils literal"><span class="pre">findBy</span></tt> y <tt class="docutils literal"><span class="pre">findOneBy</span></tt> para recuperar objetos fácilmente basándote en varias condiciones:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// consulta por un producto que coincide en nombre y precio</span>
<span class="nv">$product</span> <span class="o">=</span> <span class="nv">$repository</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;price&#39;</span> <span class="o">=&gt;</span> <span class="mf">19.99</span><span class="p">));</span>

<span class="c1">// consulta por todos los productos que coinciden</span>
<span class="c1">// con el nombre, y los ordena por precio</span>
<span class="nv">$product</span> <span class="o">=</span> <span class="nv">$repository</span><span class="o">-&gt;</span><span class="na">findBy</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;ASC&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="actualizando-un-objeto">
<h3>Actualizando un objeto<a class="headerlink" href="#actualizando-un-objeto" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Una vez que hayas extraído un objeto de <em>Doctrine</em>, actualizarlo es relativamente fácil. Supongamos que tienes una ruta que asigna un identificador de producto a una acción de actualización de un controlador:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">updateAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$dm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;doctrine.odm.mongodb.document_manager&#39;</span><span class="p">);</span>
    <span class="nv">$product</span> <span class="o">=</span> <span class="nv">$dm</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;AcmeStoreBundle:Product&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createNotFoundException</span><span class="p">(</span><span class="s1">&#39;No product found for id &#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;New product name!&#39;</span><span class="p">);</span>
    <span class="nv">$dm</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">&#39;homepage&#39;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La actualización de un objeto únicamente consiste de tres pasos:</p>
<ol class="arabic simple">
<li>Recuperar el objeto desde <em>Doctrine</em>;</li>
<li>Modificar el objeto;</li>
<li>Llamar a <tt class="docutils literal"><span class="pre">flush()</span></tt> en el gestor del documento;</li>
</ol>
<p>Ten en cuenta que <tt class="docutils literal"><span class="pre">$dm-&gt;persist($product)</span></tt> no es necesario. Recuerda que este método simplemente dice a <em>Doctrine</em> que procese o &#8220;vea&#8221; el objeto <tt class="docutils literal"><span class="pre">$product</span></tt>.
En este caso, ya que recuperaste el objeto <tt class="docutils literal"><span class="pre">$product</span></tt> desde <em>Doctrine</em>, este ya está gestionado.</p>
</div>
<div class="section" id="eliminando-un-objeto">
<h3>Eliminando un objeto<a class="headerlink" href="#eliminando-un-objeto" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La eliminación de un objeto es muy similar, pero requiere una llamada al método <tt class="docutils literal"><span class="pre">remove()</span></tt> del gestor de documentos:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$dm</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="nv">$product</span><span class="p">);</span>
<span class="nv">$dm</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
</pre></div>
</div>
<p>Como es de esperar, el método <tt class="docutils literal"><span class="pre">remove()</span></tt> notifica a <em>Doctrine</em> que deseas eliminar el documento propuesto de <em>MongoDB</em>. La operación real de eliminar sin embargo, no se ejecuta efectivamente hasta que invocas al método <tt class="docutils literal"><span class="pre">flush()</span></tt>.</p>
</div>
</div>
<div class="section" id="consultando-por-objetos">
<h2>Consultando por objetos<a class="headerlink" href="#consultando-por-objetos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Como vimos anteriormente, la clase <tt class="docutils literal"><span class="pre">repositorio</span></tt> integrada te permite consultar por uno o varios objetos basándote en una serie de diferentes parámetros. Cuando esto es suficiente, esta es la forma más sencilla de consultar documentos. Por supuesto, también puedes crear consultas más complejas.</p>
<div class="section" id="usando-el-generador-de-consultas">
<h3>Usando el generador de consultas<a class="headerlink" href="#usando-el-generador-de-consultas" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El <em>ODM</em> de <em>Doctrine</em> viene con un objeto &#8220;Generador&#8221; de consultas, el cual te permite construir una consulta para exactamente los documentos que deseas devolver. Si usas un <em>IDE</em>, también puedes tomar ventaja del autocompletado a medida que escribes los nombres de métodos.
Desde el interior de un controlador:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$products</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;doctrine.odm.mongodb.document_manager&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">createQueryBuilder</span><span class="p">(</span><span class="s1">&#39;AcmeStoreBundle:Product&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">equals</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">sort</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;ASC&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">execute</span><span class="p">()</span>
</pre></div>
</div>
<p>En este caso, devuelve 10 productos con el nombre &#8220;foo&#8221;, ordenados de menor a mayor precio.</p>
<p>El objeto <tt class="docutils literal"><span class="pre">QueryBuilder</span></tt> contiene todos los métodos necesarios para construir tu consulta. Para más información sobre el generador de consultas de <em>Doctrine</em>, consulta la documentación del <a class="reference external" href="http://www.doctrine-project.org/docs/mongodb_odm/1.0/en/reference/query-builder-api.html">Generador de consultas</a> de <em>Doctrine</em>. Para una lista de las condiciones disponibles que puedes colocar en la consulta, ve la documentación específica a los <a class="reference external" href="http://www.doctrine-project.org/docs/mongodb_odm/1.0/en/reference/query-builder-api.html#conditional-operators">Operadores condicionales</a>.</p>
</div>
<div class="section" id="repositorio-de-clases-personalizado">
<h3>Repositorio de clases personalizado<a class="headerlink" href="#repositorio-de-clases-personalizado" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En la sección anterior, comenzaste a construir y utilizar consultas más complejas desde el interior de un controlador. A fin de aislar, probar y reutilizar esas consultas, es buena idea crear una clase repositorio personalizada para tu documento y allí agregar métodos con la lógica de la consulta.</p>
<p>Para ello, agrega el nombre de la clase del repositorio a la definición de asignación.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Annotations</em><div class="highlight-php-annotations"><div class="highlight"><pre><span class="c1">// src/Acme/StoreBundle/Document/Product.php</span>
<span class="k">namespace</span> <span class="nx">Acme\StoreBundle\Document</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\ODM\MongoDB\Mapping\Annotations</span> <span class="k">as</span> <span class="nx">MongoDB</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @MongoDB\Document(repositoryClass=&quot;Acme\StoreBundle\Repository\ProductRepository&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Product</span>
<span class="p">{</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/StoreBundle/Resources/config/doctrine/Product.mongodb.yml</span>
<span class="l-Scalar-Plain">Acme\StoreBundle\Document\Product</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">repositoryClass</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Acme\StoreBundle\Repository\ProductRepository</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/StoreBundle/Resources/config/doctrine/Product.mongodb.xml --&gt;</span>
<span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;doctrine-mongo-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://doctrine-project.org/schemas/odm/doctrine-mongo-mapping&quot;</span>
      <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://doctrine-project.org/schemas/odm/doctrine-mongo-mapping</span>
<span class="s">                    http://doctrine-project.org/schemas/odm/doctrine-mongo-mapping.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;document</span> <span class="na">name=</span><span class="s">&quot;Acme\StoreBundle\Document\Product&quot;</span>
            <span class="na">repository-class=</span><span class="s">&quot;Acme\StoreBundle\Repository\ProductRepository&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;/document&gt;</span>

<span class="nt">&lt;/doctrine-mong-mapping&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p><em>Doctrine</em> puede generar la clase repositorio para ti ejecutando:</p>
<div class="highlight-bash"><div class="highlight"><pre>php app/console doctrine:mongodb:generate:repositories AcmeStoreBundle
</pre></div>
</div>
<p>A continuación, agrega un nuevo método &#8212; <tt class="docutils literal"><span class="pre">findAllOrderedByName()</span></tt> &#8212; a la clase repositorio recién generada. Este método deberá consultar por todos los documentos <tt class="docutils literal"><span class="pre">Producto</span></tt>, ordenados alfabéticamente.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/StoreBundle/Repository/ProductRepository.php</span>
<span class="k">namespace</span> <span class="nx">Acme\StoreBundle\Repository</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\ODM\MongoDB\DocumentRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProductRepository</span> <span class="k">extends</span> <span class="nx">DocumentRepository</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">findAllOrderedByName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createQueryBuilder</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">sort</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ASC&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Puedes utilizar este nuevo método al igual que los métodos de búsqueda predeterminados del repositorio:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$products</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;doctrine.odm.mongodb.document_manager&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;AcmeStoreBundle:Product&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">findAllOrderedByName</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Al utilizar una clase repositorio personalizada, todavía tienes acceso a los métodos de búsqueda predeterminados como <tt class="docutils literal"><span class="pre">find()</span></tt> y <tt class="docutils literal"><span class="pre">findAll()</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="extensiones-doctrine-timestampable-sluggable-etc">
<h2>Extensiones <em>Doctrine</em>: <tt class="docutils literal"><span class="pre">Timestampable</span></tt>, <tt class="docutils literal"><span class="pre">Sluggable</span></tt>, etc.<a class="headerlink" href="#extensiones-doctrine-timestampable-sluggable-etc" title="Enlazar permanentemente con este título">¶</a></h2>
<p><em>Doctrine</em> es bastante flexible, y dispone de una serie de extensiones de terceros que te permiten realizar fácilmente tareas repetitivas y comunes en tus entidades.
Estas incluyen cosas tales como <tt class="docutils literal"><span class="pre">Sluggable</span></tt>, <tt class="docutils literal"><span class="pre">Timestampable</span></tt>, <tt class="docutils literal"><span class="pre">registrable</span></tt>, <tt class="docutils literal"><span class="pre">traducible</span></tt> y <tt class="docutils literal"><span class="pre">Tree</span></tt>.</p>
<p>Para más información sobre cómo encontrar y utilizar estas extensiones, ve el artículo sobre el uso de <a class="reference internal" href="../../cookbook/doctrine/common_extensions.html"><em>extensiones comunes de Doctrine</em></a>.</p>
</div>
<div class="section" id="referencia-de-tipos-de-campo-doctrine">
<span id="cb-mongodb-field-types"></span><h2>Referencia de tipos de campo <em>Doctrine</em><a class="headerlink" href="#referencia-de-tipos-de-campo-doctrine" title="Enlazar permanentemente con este título">¶</a></h2>
<p><em>Doctrine</em> dispone de una gran cantidad de tipos de campo. Cada uno de estos asigna un tipo de dato <em>PHP</em> a un determinado <a class="reference external" href="http://us.php.net/manual/en/mongo.types.php">tipo de MongoDB</a>. Los siguientes son sólo <em>algunos</em> de los tipos admitidos por <em>Doctrine</em>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">string</span></tt></li>
<li><tt class="docutils literal"><span class="pre">int</span></tt></li>
<li><tt class="docutils literal"><span class="pre">float</span></tt></li>
<li><tt class="docutils literal"><span class="pre">date</span></tt></li>
<li><tt class="docutils literal"><span class="pre">timestamp</span></tt></li>
<li><tt class="docutils literal"><span class="pre">boolean</span></tt></li>
<li><tt class="docutils literal"><span class="pre">file</span></tt></li>
</ul>
<p>Para más información, consulta la sección <a class="reference external" href="http://www.doctrine-project.org/docs/mongodb_odm/1.0/en/reference/basic-mapping.html#doctrine-mapping-types">Asignando tipos</a> en la documentación de <em>Doctrine</em>.</p>
</div>
<div class="section" id="ordenes-de-consola">
<span id="index-0"></span><h2>Ordenes de consola<a class="headerlink" href="#ordenes-de-consola" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La integración <em>ODM</em> de <em>Doctrine2</em> ofrece varias ordenes de consola en el espacio de nombres <tt class="docutils literal"><span class="pre">doctrine:mongodb</span></tt>. Para ver la lista de ordenes puedes ejecutar la consola sin ningún tipo de argumento:</p>
<div class="highlight-bash"><div class="highlight"><pre>php app/console
</pre></div>
</div>
<p>Mostrará una lista con las ordenes disponibles, muchas de las cuales comienzan con el prefijo <tt class="docutils literal"><span class="pre">doctrine:mongodb</span></tt>. Puedes encontrar más información sobre cualquiera de estas ordenes (o cualquier orden de <em>Symfony</em>) ejecutando la orden <tt class="docutils literal"><span class="pre">help</span></tt>.
Por ejemplo, para obtener detalles acerca de la tarea <tt class="docutils literal"><span class="pre">doctrine:mongodb:query</span></tt>, ejecuta:</p>
<div class="highlight-bash"><div class="highlight"><pre>php app/console <span class="nb">help </span>doctrine:mongodb:query
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Para poder cargar accesorios en <em>MongoDB</em>, necesitas tener instalado el paquete <tt class="docutils literal"><span class="pre">DoctrineFixturesBundle</span></tt>. Para saber cómo hacerlo, lee el artículo &#8220;<a class="reference internal" href="../DoctrineFixturesBundle/index.html"><em>DoctrineFixturesBundle</em></a>&#8221; de la documentación.</p>
</div>
</div>
<div class="section" id="index-1">
<span id="id1"></span><h2>Configurando<a class="headerlink" href="#index-1" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para información más detallada sobre las opciones de configuración disponibles cuando utilizas el <em>ODM</em> de <em>Doctrine</em>, consulta la sección <a class="reference internal" href="config.html"><em>Referencia MongoDB</em></a>.</p>
<div class="section" id="registrando-escuchas-y-suscriptores-de-eventos">
<h3>Registrando escuchas y suscriptores de eventos<a class="headerlink" href="#registrando-escuchas-y-suscriptores-de-eventos" title="Enlazar permanentemente con este título">¶</a></h3>
<p><em>Doctrine</em> te permite registrar escuchas y suscriptores que recibirán una notificación cuando se produzcan diferentes eventos al interior del <em>ODM Doctrine</em>. Para más información, consulta la sección <a class="reference external" href="http://www.doctrine-project.org/docs/mongodb_odm/1.0/en/reference/events.html">Documentación de eventos</a> de <em>Doctrine</em>.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Además de los eventos <tt class="docutils literal"><span class="pre">ODM</span></tt>, también puedes escuchar los eventos de bajo nivel de `` MongoDB``, que encontrarás definidos en la clase <tt class="xref php php-class docutils literal"><span class="pre">DoctrineMongoDBEvents</span></tt>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Cada conexión de <em>Doctrine</em> tiene su propio gestor de eventos, el cual se comparte con los gestores de documentos vinculados a esa conexión. Los escuchas y suscriptores pueden estar registrados con todos gestores de eventos o sólo uno (usando el nombre de la conexión).</p>
</div>
<p>En <em>Symfony</em>, puedes registrar un escucha o suscriptor creando un <a class="reference internal" href="../../glossary.html#term-servicio"><em class="xref std std-term">servicio</em></a> y, a continuación <a class="reference internal" href="../../book/service_container.html#book-service-container-tags"><em>marcarlo</em></a> con una etiqueta específica.</p>
<ul>
<li><p class="first"><strong>escucha de evento</strong>: Utiliza la etiqueta <tt class="docutils literal"><span class="pre">doctrine.odm.mongodb.event_listener</span></tt> para registrar un escucha. El atributo <tt class="docutils literal"><span class="pre">event</span></tt> es necesario y debe indicar el evento a escuchar. De forma predeterminada, los escuchas serán registrados con los gestores de eventos para todas las conexiones. Para restringir un escucha a una única conexión, especifica su nombre en la etiqueta del atributo <tt class="docutils literal"><span class="pre">connection</span></tt>.</p>
<p>El atributo <tt class="docutils literal"><span class="pre">priority</span></tt>, el cual de manera predefinida es <tt class="docutils literal"><span class="pre">0</span></tt> si se omite, se puede utilizar para controlar el orden en que se registran los escuchas. Al igual que el <em class="xref std std-ref">despachador de eventos</em> de <em>Symfony2</em>, un mayor número dará lugar a que el escucha se ejecute primero y los escuchas con la misma prioridad se ejecutan en el orden en que fueron registrados en el gestor de eventos.</p>
<p>Por último, el atributo <tt class="docutils literal"><span class="pre">lazy</span></tt>, que de manera predeterminada es <cite>false`</cite> si se omite, se puede utilizar para solicitar que gestor del evento cargue al escucha de manera diferida cuando se distribuya el evento.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">my_doctrine_listener</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">Acme\HelloBundle\Listener\MyDoctrineListener</span>
        <span class="c1"># ...</span>
        <span class="l-Scalar-Plain">tags</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span>  <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">doctrine.odm.mongodb.event_listener</span><span class="p-Indicator">,</span> <span class="nv">event</span><span class="p-Indicator">:</span> <span class="nv">postPersist</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;my_doctrine_listener&quot;</span> <span class="na">class=</span><span class="s">&quot;Acme\HelloBundle\Listener\MyDoctrineListener&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;doctrine.odm.mongodb.event_listener&quot;</span> <span class="na">event=</span><span class="s">&quot;postPersist&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/service&gt;</span>.
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="nv">$definition</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Definition</span><span class="p">(</span><span class="s1">&#39;Acme\HelloBundle\Listener\MyDoctrineListener&#39;</span><span class="p">);</span>
<span class="c1">// ...</span>
<span class="nv">$definition</span><span class="o">-&gt;</span><span class="na">addTag</span><span class="p">(</span><span class="s1">&#39;doctrine.odm.mongodb.event_listener&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;event&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;postPersist&#39;</span><span class="p">,</span>
<span class="p">));</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">setDefinition</span><span class="p">(</span><span class="s1">&#39;my_doctrine_listener&#39;</span><span class="p">,</span> <span class="nv">$definition</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</div>
</li>
<li><p class="first"><strong>suscriptor de evento</strong>: Usa la etiqueta <tt class="docutils literal"><span class="pre">doctrine.odm.mongodb.event_subscriber</span></tt> para registrar un suscriptor. Los suscriptores son responsables de implementar al <tt class="docutils literal"><span class="pre">Doctrine\Common\EventSubscriber</span></tt> y suplir un método que devuelva los eventos que escuchará. Por esta razón, esta etiqueta no tiene el atributo <tt class="docutils literal"><span class="pre">event</span></tt>;
No obstante, dispone de los atributos <tt class="docutils literal"><span class="pre">connection</span></tt>, <tt class="docutils literal"><span class="pre">priority</span></tt> y <tt class="docutils literal"><span class="pre">lazy</span></tt>.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">A diferencia de los escuchas de eventos de <em>Symfony2</em>, el gestor de eventos de <em>Doctrine</em> espera que cada escucha y suscriptor tenga un nombre de método correspondiente al/los evento(s) observado(s). Por esta razón, las etiquetas antes mencionadas no tienen atributo <tt class="docutils literal"><span class="pre">method</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="integrando-el-securitybundle">
<h2>Integrando el <tt class="docutils literal"><span class="pre">SecurityBundle</span></tt><a class="headerlink" href="#integrando-el-securitybundle" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Hay disponible un proveedor de usuarios para tus proyectos <em>MongoDB</em>, trabaja exactamente igual que el proveedor de entidades descrito en el <a class="reference internal" href="../../cookbook/security/entity_provider.html"><em>recetario</em></a></p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">my_mongo_provider</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">mongodb</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span><span class="nv">class</span><span class="p-Indicator">:</span> <span class="nv">Acme\DemoBundle\Document\User</span><span class="p-Indicator">,</span> <span class="nv">property</span><span class="p-Indicator">:</span> <span class="nv">username</span><span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/security.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;my_mongo_provider&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;mongodb</span> <span class="na">class=</span><span class="s">&quot;Acme\DemoBundle\Document\User&quot;</span> <span class="na">property=</span><span class="s">&quot;username&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/provider&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="resumen">
<h2>Resumen<a class="headerlink" href="#resumen" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Con <em>Doctrine</em>, te puedes enfocar en los objetos y la forma en que son útiles en tu aplicación y en segundo lugar preocuparte de su persistencia a través de <em>MongoDB</em>. Esto se debe a que <em>Doctrine</em> te permite utilizar cualquier objeto <em>PHP</em> para almacenar los datos y confía en la información de asignación de metadatos para asignar los datos de un objeto a una colección <em>MongoDB</em>.</p>
<p>Y aunque <em>Doctrine</em> gira en torno a un concepto simple, es increíblemente potente, permitiéndote crear consultas complejas y suscribirte a los eventos que te permiten realizar diferentes acciones conforme los objetos recorren su ciclo de vida en la persistencia.</p>
</div>
<div class="section" id="aprende-mas-en-el-recetario">
<h2>Aprende más en el recetario<a class="headerlink" href="#aprende-mas-en-el-recetario" title="Enlazar permanentemente con este título">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="form.html"><em>Cómo implementar un sencillo formulario de inscripción con MongoDB</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <a href="https://github.com/symfony/symfony-standard"><img style="position: fixed; top: 0; right: 0; border: 0;" src="http://gitnacho.github.com/tnp/img/comun/bifurcame.png" alt="Bifúrcame en GitHub" /></a>
  
  <div style="width:740px;margin:10px auto;">
    
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="config.html" title="Configurando DoctrineMongoDBBundle"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="../DoctrineMigrationsBundle/index.html" title="DoctrineMigrationsBundle"
             >anterior</a> |</li>
        <li><a href="../../index.html">en Español</a> &raquo;</li>
          <li><a href="../index.html" >Paquetes de la edición estándar de <em>Symfony</em></a> &raquo;</li> 
      </ul>
    </div>
  </div>


   <div style="width: 740px; margin: 0 auto;">
     <div id="disqus_thread"></div>
     
    <div class="footer">
        &copy; Copyright 2011-2012, Traducido por Nacho Pacheco.
      Actualizado por última vez en May 28, 2012.
      Creado con <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
   </div>
   <script type="text/javascript">
    var disqus_shortname = 'documentos-mx';
    var disqus_developer = 1;
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
   </script>
   <noscript>
     Por favor activa JavaScript para ver los <a href="http://disqus.com/?ref_noscript">comentarios accionados por Disqus.</a>
   </noscript>

  </body>
</html>