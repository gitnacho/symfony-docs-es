
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DoctrineFixturesBundle &mdash; Manual de Symfony2 en Español</title>
    
    <link rel="stylesheet" href="../../_static/tnp.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0.12',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="shortcut icon" href="../../_static/icotnp.ico"/>
    <link rel="top" title="Manual de Symfony2 en Español" href="../../index.html" />
    <link rel="up" title="Paquetes de la edición estándar de Symfony" href="../index.html" />
    <link rel="next" title="DoctrineMigrationsBundle" href="../DoctrineMigrationsBundle/index.html" />
    <link rel="prev" title="Generando una nueva clase de tipo Form basada en una entidad Doctrine" href="../SensioGeneratorBundle/commands/generate_doctrine_form.html" /> 
  </head>
  <body>
  <div class="imalogo">
    
  <a href="../../index.html"><img src="http://gitnacho.github.com/tnp/_static/logo-big.gif" alt="Edición estándar de Symfony2" />
  
    <a href="http://gitnacho.github.com/tnp/"><img src="http://gitnacho.github.com/tnp/_static/normaltnp.png" alt="Traducciones de Nacho Pacheco" /></a>
    <div class="social">
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="esymfony" data-lang="es">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
    <div id="searchbox">
      <form class="searc " action="../../search.html" method="get">
      <input type="search" name="q" placeholder="Término a buscar" />
      <input type="submit" value="Ir" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
    

    
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../DoctrineMigrationsBundle/index.html" title="DoctrineMigrationsBundle"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="../SensioGeneratorBundle/commands/generate_doctrine_form.html" title="Generando una nueva clase de tipo Form basada en una entidad Doctrine"
             accesskey="P">anterior</a> |</li>
        <li><a href="../../index.html">en Español</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Paquetes de la edición estándar de <em>Symfony</em></a> &raquo;</li> 
      </ul>
    </div>
  </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="doctrinefixturesbundle">
<h1><tt class="docutils literal"><span class="pre">DoctrineFixturesBundle</span></tt><a class="headerlink" href="#doctrinefixturesbundle" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Los accesorios se utilizan para cargar en una base de datos un juego de datos controlado. Puedes utilizar estos datos para pruebas o podrían ser los datos iniciales necesarios para ejecutar la aplicación sin problemas. <em>Symfony2</em> no tiene integrada forma alguna de administrar accesorios, pero <em>Doctrine2</em> cuenta con una biblioteca para ayudarte a escribir accesorios para el <a class="reference internal" href="../../book/doctrine.html"><em>ORM</em></a> u <a class="reference internal" href="../DoctrineMongoDBBundle/index.html"><em>ODM</em></a> de <em>Doctrine</em>.</p>
<div class="section" id="instalando-y-configurando">
<h2>Instalando y configurando<a class="headerlink" href="#instalando-y-configurando" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Si todavía no tienes configurada en <em>Symfony2</em> la biblioteca <a class="reference external" href="https://github.com/doctrine/data-fixtures">Doctrine Data Fixtures</a>, sigue estos pasos para hacerlo.</p>
<p>Si estás utilizando la distribución estándar, agrega lo siguiente a tu archivo <tt class="docutils literal"><span class="pre">deps</span></tt>:</p>
<div class="highlight-text"><div class="highlight"><pre>[doctrine-fixtures]
    git=http://github.com/doctrine/data-fixtures.git

[DoctrineFixturesBundle]
    git=http://github.com/doctrine/DoctrineFixturesBundle.git
    target=/bundles/Doctrine/Bundle/FixturesBundle
</pre></div>
</div>
<p>Actualiza las bibliotecas de proveedores:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>php bin/vendors install
</pre></div>
</div>
<p>Si todo funcionó, ahora puedes encontrar la biblioteca <tt class="docutils literal"><span class="pre">doctrine-fixtures</span></tt> en <tt class="docutils literal"><span class="pre">vendor/doctrine-fixtures</span></tt>.</p>
<p>Registra el espacio de nombres <tt class="docutils literal"><span class="pre">Doctrine\Common\DataFixtures</span></tt> en <tt class="docutils literal"><span class="pre">app/autoload.php</span></tt>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">registerNamespaces</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;Doctrine\\Bundle&#39;</span> <span class="o">=&gt;</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../vendor/bundles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Doctrine\\Common\\DataFixtures&#39;</span> <span class="o">=&gt;</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../vendor/doctrine-fixtures/lib&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Doctrine\\Common&#39;</span> <span class="o">=&gt;</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../vendor/doctrine-common/lib&#39;</span><span class="p">,</span>
    <span class="c1">// ...</span>
<span class="p">));</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="first admonition-title">Prudencia</p>
<p class="last">Asegúrate de registrar el nuevo espacio de nombres <em>antes</em> de <tt class="docutils literal"><span class="pre">Doctrine\Common</span></tt>. De lo contrario, <em>Symfony</em> buscará clases accesorio dentro del directorio <tt class="docutils literal"><span class="pre">Doctrine\Common</span></tt>. El autocargador de <em>Symfony</em>, siempre busca en primer lugar una clase dentro del directorio del espacio de nombres coincidente, los espacios de nombres más específicos <em>siempre</em> deben estar primero.</p>
</div>
<p>Por último, registra el paquete <tt class="docutils literal"><span class="pre">DoctrineFixturesBundle</span></tt> en <tt class="docutils literal"><span class="pre">app/AppKernel.php</span></tt>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">registerBundles</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$bundles</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="c1">// ...</span>
        <span class="k">new</span> <span class="nx">Doctrine\Bundle\FixturesBundle\DoctrineFixturesBundle</span><span class="p">(),</span>
        <span class="c1">// ...</span>
    <span class="p">);</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="escribiendo-accesorios-sencillos">
<h2>Escribiendo accesorios sencillos<a class="headerlink" href="#escribiendo-accesorios-sencillos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los accesorios de <em>Doctrine2</em> son clases <em>PHP</em> que pueden crear y persistir objetos a la base de datos. Al igual que todas las clases en <em>Symfony2</em>, los accesorios deben vivir dentro de uno de los paquetes de tu aplicación.</p>
<p>Para un paquete situado en <tt class="docutils literal"><span class="pre">src/Acme/HelloBundle</span></tt>, las clases accesorio deben vivir dentro de <tt class="docutils literal"><span class="pre">src/Acme/HelloBundle/DataFixtures/ORM</span></tt> o <tt class="docutils literal"><span class="pre">src/Acme/HelloBundle/DataFixtures/MongoDB</span></tt>, para <em>ORM</em> y <em>ODM</em> respectivamente, esta guía asume que estás utilizando el <em>ORM</em> &#8212; pero, los accesorios se pueden agregar con la misma facilidad si estás utilizando <em>ODM</em>.</p>
<p>Imagina que tienes una clase <tt class="docutils literal"><span class="pre">User</span></tt>, y te gustaría cargar un nuevo <tt class="docutils literal"><span class="pre">Usuario</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/HelloBundle/DataFixtures/ORM/LoadUserData.php</span>

<span class="k">namespace</span> <span class="nx">Acme\HelloBundle\DataFixtures\ORM</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\Common\DataFixtures\FixtureInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\Persistence\ObjectManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Acme\HelloBundle\Entity\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LoadUserData</span> <span class="k">implements</span> <span class="nx">FixtureInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * {@inheritDoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">load</span><span class="p">(</span><span class="nx">ObjectManager</span> <span class="nv">$manager</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$userAdmin</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$userAdmin</span><span class="o">-&gt;</span><span class="na">setUsername</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">);</span>
        <span class="nv">$userAdmin</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>

        <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$userAdmin</span><span class="p">);</span>
        <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>En <em>Doctrine2</em>, los accesorios sólo son objetos en los que cargas datos interactuando con tus entidades como lo haces normalmente. Esto te permite crear el accesorio exacto que necesitas para tu aplicación.</p>
<p>La limitación más importante es que no puedes compartir objetos entre accesorios.
Más adelante, veremos la manera de superar esta limitación.</p>
</div>
<div class="section" id="ejecutando-accesorios">
<h2>Ejecutando accesorios<a class="headerlink" href="#ejecutando-accesorios" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Una vez que has escrito tus accesorios, los puedes cargar a través de la línea de ordenes usando la orden <tt class="docutils literal"><span class="pre">doctrine:fixtures:load</span></tt></p>
<div class="highlight-bash"><div class="highlight"><pre>php app/console doctrine:fixtures:load
</pre></div>
</div>
<p>Si estás utilizando <em>ODM</em>, en su lugar usa la orden <tt class="docutils literal"><span class="pre">doctrine:mongodb:fixtures:load</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre>php app/console doctrine:mongodb:fixtures:load
</pre></div>
</div>
<p>La tarea verá dentro del directorio <tt class="docutils literal"><span class="pre">DataFixtures/ORM</span></tt> (o <tt class="docutils literal"><span class="pre">DataFixtures/MongoDB</span></tt> para <em>ODM</em>) de cada paquete y ejecutará cada clase que implemente la <tt class="docutils literal"><span class="pre">FixtureInterface</span></tt>.</p>
<p>Ambas ordenes vienen con unas cuantas opciones:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">--fixtures=/ruta/al/accesorio</span></tt> &#8212; Usa esta opción para especificar manualmente el directorio de donde se deben cargar las clases accesorio;</li>
<li><tt class="docutils literal"><span class="pre">--append</span></tt> &#8212; Utiliza esta opción para añadir datos en lugar de eliminarlos antes de cargarlos (borrar primero es el comportamiento predeterminado);</li>
<li><tt class="docutils literal"><span class="pre">--em=manager_name</span></tt> &#8212; Especifica manualmente el gestor de la entidad a utilizar para cargar los datos.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si utilizas la tarea <tt class="docutils literal"><span class="pre">doctrine:mongodb:fixtures:load</span></tt>, reemplaza la opción <tt class="docutils literal"><span class="pre">--em=</span></tt> con <tt class="docutils literal"><span class="pre">--dm=</span></tt> para especificar manualmente el gestor de documentos.</p>
</div>
<p>Un ejemplo de uso completo podría tener este aspecto:</p>
<div class="highlight-bash"><div class="highlight"><pre>php app/console doctrine:fixtures:load --fixtures<span class="o">=</span>/ruta/al/accesorio1 --fixtures<span class="o">=</span>/ruta/al/accesorio2 --append --em<span class="o">=</span>gestor_foo
</pre></div>
</div>
</div>
<div class="section" id="compartiendo-objetos-entre-accesorios">
<h2>Compartiendo objetos entre accesorios<a class="headerlink" href="#compartiendo-objetos-entre-accesorios" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Escribir un accesorio básico es sencillo. Pero, ¿si tienes varias clases de accesorios y quieres poder referirte a los datos cargados en otras clases accesorio?
Por ejemplo, ¿qué pasa si cargas un objeto <tt class="docutils literal"><span class="pre">Usuario</span></tt> en un accesorio, y luego quieres mencionar una referencia a un accesorio diferente con el fin de asignar dicho usuario a un grupo particular?</p>
<p>La biblioteca de accesorios de <em>Doctrine</em> maneja esto fácilmente permitiéndote especificar el orden en que se cargan los accesorios.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/HelloBundle/DataFixtures/ORM/LoadUserData.php</span>
<span class="k">namespace</span> <span class="nx">Acme\HelloBundle\DataFixtures\ORM</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\Common\DataFixtures\AbstractFixture</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\DataFixtures\OrderedFixtureInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\Persistence\ObjectManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Acme\HelloBundle\Entity\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LoadUserData</span> <span class="k">extends</span> <span class="nx">AbstractFixture</span> <span class="k">implements</span> <span class="nx">OrderedFixtureInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * {@inheritDoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">load</span><span class="p">(</span><span class="nx">ObjectManager</span> <span class="nv">$manager</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$userAdmin</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$userAdmin</span><span class="o">-&gt;</span><span class="na">setUsername</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">);</span>
        <span class="nv">$userAdmin</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>

        <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$userAdmin</span><span class="p">);</span>
        <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addReference</span><span class="p">(</span><span class="s1">&#39;admin-user&#39;</span><span class="p">,</span> <span class="nv">$userAdmin</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * {@inheritDoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOrder</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// el orden en el cual serán cargados los accesorios</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La clase accesorio ahora implementa la <tt class="docutils literal"><span class="pre">OrderedFixtureInterface</span></tt>, la cual dice a <em>Doctrine</em> que deseas controlar el orden de tus accesorios. Crea otra clase accesorio y haz que se cargue después de <tt class="docutils literal"><span class="pre">LoadUserData</span></tt> devolviendo un orden de 2:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/HelloBundle/DataFixtures/ORM/LoadGroupData.php</span>

<span class="k">namespace</span> <span class="nx">Acme\HelloBundle\DataFixtures\ORM</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\Common\DataFixtures\AbstractFixture</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\DataFixtures\OrderedFixtureInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\Persistence\ObjectManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Acme\HelloBundle\Entity\Group</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LoadGroupData</span> <span class="k">extends</span> <span class="nx">AbstractFixture</span> <span class="k">implements</span> <span class="nx">OrderedFixtureInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * {@inheritDoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">load</span><span class="p">(</span><span class="nx">ObjectManager</span> <span class="nv">$manager</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$groupAdmin</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Group</span><span class="p">();</span>
        <span class="nv">$groupAdmin</span><span class="o">-&gt;</span><span class="na">setGroupName</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">);</span>

        <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$groupAdmin</span><span class="p">);</span>
        <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addReference</span><span class="p">(</span><span class="s1">&#39;admin-group&#39;</span><span class="p">,</span> <span class="nv">$groupAdmin</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * {@inheritDoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOrder</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// el orden en el cual serán cargados los accesorios</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ambas clases accesorio extienden <tt class="docutils literal"><span class="pre">AbstractFixture</span></tt>, lo cual te permite crear objetos y luego ponerlos como referencias para que se puedan utilizar posteriormente en otros accesorios. Por ejemplo, más tarde puedes referirte a los objetos <tt class="docutils literal"><span class="pre">$userAdmin</span></tt> y <tt class="docutils literal"><span class="pre">$groupAdmin</span></tt> a través de las referencias <tt class="docutils literal"><span class="pre">admin-user</span></tt> y <tt class="docutils literal"><span class="pre">admin-group</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/HelloBundle/DataFixtures/ORM/LoadUserGroupData.php</span>

<span class="k">namespace</span> <span class="nx">Acme\HelloBundle\DataFixtures\ORM</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\Common\DataFixtures\AbstractFixture</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\DataFixtures\OrderedFixtureInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\Persistence\ObjectManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Acme\HelloBundle\Entity\UserGroup</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LoadUserGroupData</span> <span class="k">extends</span> <span class="nx">AbstractFixture</span> <span class="k">implements</span> <span class="nx">OrderedFixtureInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * {@inheritDoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">load</span><span class="p">(</span><span class="nx">ObjectManager</span> <span class="nv">$manager</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$userGroupAdmin</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserGroup</span><span class="p">();</span>
        <span class="nv">$userGroupAdmin</span><span class="o">-&gt;</span><span class="na">setUser</span><span class="p">(</span><span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">merge</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getReference</span><span class="p">(</span><span class="s1">&#39;admin-user&#39;</span><span class="p">)));</span>
        <span class="nv">$userGroupAdmin</span><span class="o">-&gt;</span><span class="na">setGroup</span><span class="p">(</span><span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">merge</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getReference</span><span class="p">(</span><span class="s1">&#39;admin-group&#39;</span><span class="p">)));</span>

        <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$userGroupAdmin</span><span class="p">);</span>
        <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * {@inheritDoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOrder</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Los accesorios ahora se ejecutan en el orden ascendente del valor devuelto por <tt class="docutils literal"><span class="pre">getOrder()</span></tt>. Cualquier objeto que se establece con el método <tt class="docutils literal"><span class="pre">setReference()</span></tt> se puede acceder a través de <tt class="docutils literal"><span class="pre">getReference()</span></tt> en las clases accesorio que tienen un orden superior.</p>
<p>Los accesorios te permiten crear cualquier tipo de dato que necesites a través de la interfaz normal de <em>PHP</em> para crear y persistir objetos. Al controlar el orden de los accesorios y establecer referencias, puedes manejar casi todo por medio de accesorios.</p>
</div>
<div class="section" id="usando-el-contenedor-en-los-accesorios">
<h2>Usando el contenedor en los accesorios<a class="headerlink" href="#usando-el-contenedor-en-los-accesorios" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En algunos casos necesitarás acceder a algunos servicios para cargar los accesorios.
<em>Symfony2</em> hace esto realmente fácil. El contenedor se inyectará en todas las clases accesorio que implementen la <tt class="xref php php-class docutils literal"><span class="pre">Symfony\Component\DependencyInjection\ContainerAwareInterface</span></tt>.</p>
<p>Vamos a rescribir el primer accesorio para codificar la contraseña antes de almacenarla en la base de datos (una muy buena práctica). Esto utilizará el generador de codificadores para codificar la contraseña, garantizando que está codificada en la misma forma que la utiliza el componente de seguridad al efectuar la verificación:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/Acme/HelloBundle/DataFixtures/ORM/LoadUserData.php</span>

<span class="k">namespace</span> <span class="nx">Acme\HelloBundle\DataFixtures\ORM</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\Common\DataFixtures\FixtureInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\ContainerAwareInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\ContainerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Acme\HelloBundle\Entity\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LoadUserData</span> <span class="k">implements</span> <span class="nx">FixtureInterface</span><span class="p">,</span> <span class="nx">ContainerAwareInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var ContainerInterface</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$container</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * {@inheritDoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setContainer</span><span class="p">(</span><span class="nx">ContainerInterface</span> <span class="nv">$container</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span> <span class="o">=</span> <span class="nv">$container</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * {@inheritDoc}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">load</span><span class="p">(</span><span class="nx">ObjectManager</span> <span class="nv">$manager</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setUsername</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">);</span>
        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setSalt</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nb">uniqid</span><span class="p">()));</span>

        <span class="nv">$encoder</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span>
            <span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;security.encoder_factory&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">getEncoder</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span>
        <span class="p">;</span>
        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$encoder</span><span class="o">-&gt;</span><span class="na">encodePassword</span><span class="p">(</span><span class="s1">&#39;secret&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getSalt</span><span class="p">()));</span>

        <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
        <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Como puedes ver, todo lo que necesitas hacer es agregar <tt class="xref php php-class docutils literal"><span class="pre">Symfony\Component\DependencyInjection\ContainerAwareInterface</span></tt> a la clase y luego crear un nuevo método <a href="#id1"><span class="problematic" id="id2">:method:`Symfony\\Component\\DependencyInjection\\ContainerInterface::setContainer`</span></a> que implemente esa interfaz. Antes de ejecutar el accesorio, <em>Symfony</em>  automáticamente llamará al método <a href="#id3"><span class="problematic" id="id4">:method:`Symfony\\Component\\DependencyInjection\\ContainerInterface::setContainer`</span></a>. Siempre y cuando guardes el contenedor como una propiedad en la clase (como se muestra arriba), puedes acceder a él en el método <tt class="docutils literal"><span class="pre">load()</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si te da flojera implementar el método necesario <a href="#id5"><span class="problematic" id="id6">:method:`Symfony\\Component\\DependencyInjection\\ContainerInterface::setContainer`</span></a>, entonces, puedes extender tu clase con <tt class="xref php php-class docutils literal"><span class="pre">Symfony\Component\DependencyInjection\ContainerAware</span></tt>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <a href="https://github.com/symfony/symfony-standard"><img style="position: fixed; top: 0; right: 0; border: 0;" src="http://gitnacho.github.com/tnp/_static/bifurcame.png" alt="Bifúrcame en GitHub" /></a>
  
  <div style="width:740px;margin:10px auto;">
    
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../DoctrineMigrationsBundle/index.html" title="DoctrineMigrationsBundle"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="../SensioGeneratorBundle/commands/generate_doctrine_form.html" title="Generando una nueva clase de tipo Form basada en una entidad Doctrine"
             >anterior</a> |</li>
        <li><a href="../../index.html">en Español</a> &raquo;</li>
          <li><a href="../index.html" >Paquetes de la edición estándar de <em>Symfony</em></a> &raquo;</li> 
      </ul>
    </div>
  </div>


   <div style="width: 740px; margin: 0 auto;">
     <div id="disqus_thread"></div>
     
    <div class="footer">
        &copy; Copyright 2011-2012, Traducido por Nacho Pacheco.
      Actualizado por última vez en Apr 16, 2012.
      Creado con <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
   </div>
   <script type="text/javascript">
    var disqus_shortname = 'documentos-mx';
    var disqus_developer = 1;
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
   </script>
   <noscript>
     Por favor activa JavaScript para ver los <a href="http://disqus.com/?ref_noscript">comentarios accionados por Disqus.</a>
   </noscript>

  </body>
</html>