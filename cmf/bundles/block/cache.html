
<!DOCTYPE html> 
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Almacenando en caché &mdash; Manual de Symfony2 en Español</title>
    
    <link rel="stylesheet" href="../../../_static/tnp.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.0.15',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/translations.js"></script>
    <link rel="shortcut icon" href="../../../_static/icotnp.ico"/>
    <link rel="top" title="Manual de Symfony2 en Español" href="../../../index.html" />
    <link rel="up" title="BlockBundle" href="../block.html" />
    <link rel="next" title="4. Relación al paquete Block de Sonata" href="relation_to_sonata_block_bundle.html" />
    <link rel="prev" title="2. Creando tus propios bloques" href="create_your_own_blocks.html" /> 
  </head>
  <body>
  <div class="imalogo">
    
  <a href="../../../index.html"><img src="http://gitnacho.github.com/tnp/img/sf/logo-big.gif" alt="Edición estándar de Symfony2" />
  
    <a href="../../../index.html"><img src="http://gitnacho.github.com/tnp/_static/normaltnp.png" alt="Traducciones de Nacho Pacheco" /></a>
    <div class="social">
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="esymfony" data-lang="es">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
    <div id="searchbox">
      <form class="searc " action="../../../search.html" method="get">
      <input type="search" name="q" placeholder="Término a buscar" />
      <input type="submit" value="Ir" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
    

    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="relation_to_sonata_block_bundle.html" title="4. Relación al paquete Block de Sonata"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="create_your_own_blocks.html" title="2. Creando tus propios bloques"
             accesskey="P">anterior</a> |</li>
        <li><a href="../../../index.html">en Español</a> &raquo;</li>
          <li><a href="../../index.html" >Documentación del <tt class="docutils literal docutils literal"><span class="pre">CMF</span></tt> de <em>Symfony</em></a> &raquo;</li>
          <li><a href="../block.html" accesskey="U"><tt class="docutils literal docutils literal"><span class="pre">BlockBundle</span></tt></a> &raquo;</li> 
      </ul>
    </div>
  </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="almacenando-en-cache">
<h1>3. Almacenando en caché<a class="headerlink" href="#almacenando-en-cache" title="Enlazar permanentemente con este título">¶</a></h1>
<p>El paquete <tt class="docutils literal"><span class="pre">BlockBundle</span></tt> integra con el <a class="reference external" href="https://github.com/sonata-project/SonataCacheBundle">SonataCacheBundle</a> para proporcionar varias soluciones de almacenamiento en caché. Dale un vistazo a los adaptadores disponibles en el <tt class="docutils literal"><span class="pre">SonataCacheBundle</span></tt> para ver todas las opciones.</p>
<p>El <tt class="docutils literal"><span class="pre">BlockBundle</span></tt> además proporciona sus propios adaptadores para:</p>
<ul class="simple">
<li><a class="reference external" href="http://wikipedia.org/wiki/Edge_Side_Includes">ESI</a></li>
<li><a class="reference external" href="http://wikipedia.org/wiki/Server_Side_Includes">SSI</a></li>
<li>Javascript asíncrono</li>
<li>Javascript sincrónico</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Es aconsejable almacenar todas las opciones en el bloque documento al utilizar la memoria caché.</p>
</div>
<div class="section" id="dependencias">
<h2>3.1. Dependencias<a class="headerlink" href="#dependencias" title="Enlazar permanentemente con este título">¶</a></h2>
<p>The cache functionality is optional and depends on the <a class="reference external" href="https://github.com/sonata-project/SonataCacheBundle">SonataCacheBundle</a>.</p>
</div>
<div class="section" id="instalando">
<h2>3.2. Instalando<a class="headerlink" href="#instalando" title="Enlazar permanentemente con este título">¶</a></h2>
<p>The installation is split between the SonataCacheBundle, the SymfonyCmfBlockBundle and the SonataBlockBundle:</p>
<ol class="arabic simple">
<li><em>SonataCacheBundle</em> - Follow the installation instructions from the <a class="reference external" href="http://sonata-project.org/bundles/cache/master/doc/index.html">SonataCacheBundle documentation</a>.</li>
<li><em>SymfonyCmfBlockBundle</em> - At the end of your routing file, add the following lines:</li>
</ol>
<blockquote>
<div><div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/routing.yml</span>
<span class="c1"># ...</span>
<span class="c1"># routes SymfonyCmfBlockBundle cache adapters</span>
<span class="l-Scalar-Plain">block_cache</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">resource</span><span class="p-Indicator">:</span> <span class="s">&quot;@SymfonyCmfBlockBundle/Resources/config/routing/cache.xml&quot;</span>
    <span class="l-Scalar-Plain">prefix</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><em>SonataBlockBundle</em> - Use the <tt class="docutils literal"><span class="pre">sonata_block</span></tt> key to configure the cache adapter for each block service.</li>
</ol>
<blockquote>
<div><div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">sonata_block</span><span class="p-Indicator">:</span>
<span class="c1"># ...</span>
    <span class="l-Scalar-Plain">blocks</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">symfony_cmf.block.action</span><span class="p-Indicator">:</span>
            <span class="c1"># Usa el id del adaptador del servicio cache</span>
            <span class="l-Scalar-Plain">cache</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">symfony_cmf.block.cache.js_async</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div></blockquote>
</div>
<div class="section" id="flujo-de-trabajo">
<h2>3.3. Flujo de trabajo<a class="headerlink" href="#flujo-de-trabajo" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Lo siguiente sucede al dibujar un bloque la memoria caché:</p>
<ul class="simple">
<li>se carga un documento basándose en el nombre</li>
<li>si está configurada la memorización en caché, se revisa la caché y si se encuentra el contenido se devuelve</li>
<li><ul class="first">
<li>las claves de la caché se componen utilizando:<ul>
<li>the cache keys of the block service</li>
<li>the extraCacheKeys passed from the template</li>
</ul>
</li>
<li>the cache adapter is asked for a cache element<ul>
<li>the ESI and SSI adapter add a specific tag and a url to retrieve the block content</li>
<li>the Javascript adapter adds javascript and a url to retrieve the block content</li>
</ul>
</li>
<li>if the cache element is not expired and has data it is returned</li>
</ul>
</li>
<li>the template is rendered:<ul>
<li>for ESI and SSI the url is called to retrieve the block content</li>
<li>for Javascript the browser calls a url and replaces a placeholder with the returned block content</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">The additional cache adapters of the BlockBundle always return that the cache is found, have a look at the <tt class="docutils literal"><span class="pre">has</span></tt>
method of the adapters in the SonataCacheBundle to see how they respond.</p>
</div>
<p>If cache is checked and the cache adapter returned that no cache was found, the workflow proceeds like this:</p>
<ul class="simple">
<li>each block document also has a block service, the execute method of it is called to render the block and return a response</li>
<li>if the response is cacheable the configured adapter creates a cache element, it contains<ul>
<li>the computed cache keys</li>
<li>the ttl of the response</li>
<li>the response</li>
<li>and additional contextual keys</li>
</ul>
</li>
<li>the template is rendered</li>
</ul>
</div>
<div class="section" id="cache-keys">
<h2>3.4. Cache keys<a class="headerlink" href="#cache-keys" title="Enlazar permanentemente con este título">¶</a></h2>
<p>The block service has the responsibility to generate the cache keys, the method <tt class="docutils literal"><span class="pre">getCacheKeys</span></tt> returns these keys, see
<a class="reference internal" href="../block.html#block-service"><em>Bloque de servicio</em></a>.</p>
<p>The block services shipped with the BlockBunde use the <tt class="docutils literal"><span class="pre">getCacheKeys</span></tt> method of the <tt class="docutils literal"><span class="pre">Sonata\BlockBundle\Block\BaseBlockService</span></tt>,
and return:</p>
<ul class="simple">
<li>block_id</li>
<li>updated_at</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">If block settings need to be persisted between requests it is advised to store them in the block document. Alternatively
they can be added to the cache keys. However be very cautious because, depending on the adapter, the cache keys can be
send to the browser and are not secure.</p>
</div>
<div class="section" id="extra-cache-keys">
<h3>3.4.1. Extra cache keys<a class="headerlink" href="#extra-cache-keys" title="Enlazar permanentemente con este título">¶</a></h3>
<p>The extra cache keys array is used to store metadata along the cache element. The metadata can be used to invalidate a
set of cache elements.</p>
</div>
<div class="section" id="contextual-keys">
<h3>3.4.2. Contextual keys<a class="headerlink" href="#contextual-keys" title="Enlazar permanentemente con este título">¶</a></h3>
<p>The contextual cache array hold the object class and id used inside the template. This contextual cache array is then
added to the extra cache key.</p>
<p>This feature can be use like this <tt class="docutils literal"><span class="pre">$cacheManager-&gt;remove(array('objectId'</span> <span class="pre">=&gt;</span> <span class="pre">'id'))</span></tt>.</p>
<p>Of course not all cache adapters support this feature, varnish and mongodb do.</p>
<p>The BlockBundle also has a cache invalidation listener that calls the <tt class="docutils literal"><span class="pre">flush</span></tt> method of a cache adapter automatically
when a cached block document is updated or removed.</p>
</div>
</div>
<div class="section" id="dibujando-el-bloque">
<h2>3.5. Dibujando el bloque<a class="headerlink" href="#dibujando-el-bloque" title="Enlazar permanentemente con este título">¶</a></h2>
<p>The following parameters can be used in the <tt class="docutils literal"><span class="pre">sonata_block_render</span></tt> code in your Twig template when using cache:</p>
<ul class="simple">
<li><strong>useCache</strong>: use the configured cache for a block (<em>default</em>: true)</li>
<li><strong>extraCachekeys</strong>: expects an array with extra cache keys (<em>default</em>: empty array)</li>
</ul>
<div class="highlight-jinja"><div class="highlight"><pre><span class="cp">{{</span> <span class="nv">sonata_block_render</span><span class="o">(</span>
    <span class="o">{</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="s1">&#39;rssBlock&#39;</span> <span class="o">},</span>
    <span class="kp">true</span><span class="o">,</span>
    <span class="o">{</span> <span class="s1">&#39;extra_key&#39;</span><span class="o">:</span> <span class="s1">&#39;my_block&#39;</span> <span class="o">}</span>
<span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
</pre></div>
</div>
</div>
<div class="section" id="adaptadores">
<h2>3.6. Adaptadores<a class="headerlink" href="#adaptadores" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="id2">
<h3>3.6.1. <em>ESI</em><a class="headerlink" href="#id2" title="Enlazar permanentemente con este título">¶</a></h3>
<p>This extends the default EsiCache adapter of the SonataCacheBundle.</p>
<div class="section" id="configurando">
<h4>3.6.1.1. Configurando<a class="headerlink" href="#configurando" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">symfony_cmf_block</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">caches</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">esi</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">token</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">a unique security key</span> <span class="c1"># a random one is generated by default</span>
            <span class="l-Scalar-Plain">servers</span><span class="p-Indicator">:</span>
                <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">varnishadm -T 127.0.0.1:2000 {{ COMMAND }} &quot;{{ EXPRESSION }}&quot;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>3.6.2. SSI<a class="headerlink" href="#id3" title="Enlazar permanentemente con este título">¶</a></h3>
<p>This extends the default SsiCache adapter of the SonataCacheBundle.</p>
<div class="section" id="id4">
<h4>3.6.2.1. Configurando<a class="headerlink" href="#id4" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">symfony_cmf_block</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">caches</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">ssi</span><span class="p-Indicator">:</span>
           <span class="l-Scalar-Plain">token</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">una clave de seguridad única</span> <span class="c1"># de manera predeterminada se genera una aleatoria</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="javascript">
<h3>3.6.3. <em>JavaScript</em><a class="headerlink" href="#javascript" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Renders the block using javascript, the page is loaded and not waiting for the block to be finished rendering or
retrieving data. The block is then asynchronously or synchronously loaded and added to the page.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <a href="https://github.com/symfony/symfony-standard"><img style="position: fixed; top: 0; right: 0; border: 0;" src="http://gitnacho.github.com/tnp/img/comun/bifurcame.png" alt="Bifúrcame en GitHub" /></a>
  
  <div style="width:740px;margin:10px auto;">
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="relation_to_sonata_block_bundle.html" title="4. Relación al paquete Block de Sonata"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="create_your_own_blocks.html" title="2. Creando tus propios bloques"
             >anterior</a> |</li>
        <li><a href="../../../index.html">en Español</a> &raquo;</li>
          <li><a href="../../index.html" >Documentación del <tt class="docutils literal docutils literal"><span class="pre">CMF</span></tt> de <em>Symfony</em></a> &raquo;</li>
          <li><a href="../block.html" ><tt class="docutils literal docutils literal"><span class="pre">BlockBundle</span></tt></a> &raquo;</li> 
      </ul>
    </div>
  </div>


   <div style="width: 740px; margin: 0 auto;">
     <div id="disqus_thread"></div>
     
    <div class="footer">
        &copy; Copyright 2011-2013, Traducido por Nacho Pacheco.
      Actualizado por última vez en Mar 19, 2013.
      Creado con <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
   </div>
   <script type="text/javascript">
    var disqus_shortname = 'documentos-mx';
    var disqus_developer = 1;
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
   </script>
   <noscript>
     Por favor activa JavaScript para ver los <a href="http://disqus.com/?ref_noscript">comentarios accionados por Disqus.</a>
   </noscript>

  </body>
</html>