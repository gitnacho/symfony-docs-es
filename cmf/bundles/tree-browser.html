
<!DOCTYPE html> 
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>TreeBrowserBundle &mdash; Manual de Symfony2 en Español</title>
    
    <link rel="stylesheet" href="../../_static/tnp.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0.15',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="shortcut icon" href="../../_static/icotnp.ico"/>
    <link rel="top" title="Manual de Symfony2 en Español" href="../../index.html" />
    <link rel="up" title="Documentación del CMF de Symfony" href="../index.html" />
    <link rel="next" title="Usando una clase documento personalizada asociada con PHPCR-ODM" href="../cookbook/phpcr-odm-custom-documentclass-mapper.html" />
    <link rel="prev" title="SonataDoctrinePhpcrAdminBundle" href="doctrine_phpcr_admin.html" /> 
  </head>
  <body>
  <div class="imalogo">
    
  <a href="../../index.html"><img src="http://gitnacho.github.com/tnp/img/sf/logo-big.gif" alt="Edición estándar de Symfony2" />
  
    <a href="../../index.html"><img src="http://gitnacho.github.com/tnp/_static/normaltnp.png" alt="Traducciones de Nacho Pacheco" /></a>
    <div class="social">
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="esymfony" data-lang="es">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
    <div id="searchbox">
      <form class="searc " action="../../search.html" method="get">
      <input type="search" name="q" placeholder="Término a buscar" />
      <input type="submit" value="Ir" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
    

    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../cookbook/phpcr-odm-custom-documentclass-mapper.html" title="Usando una clase documento personalizada asociada con PHPCR-ODM"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="doctrine_phpcr_admin.html" title="SonataDoctrinePhpcrAdminBundle"
             accesskey="P">anterior</a> |</li>
        <li><a href="../../index.html">en Español</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Documentación del <tt class="docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal"><span class="pre">CMF</span></tt> de <em>Symfony</em></a> &raquo;</li> 
      </ul>
    </div>
  </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="treebrowserbundle">
<h1><tt class="docutils literal"><span class="pre">TreeBrowserBundle</span></tt><a class="headerlink" href="#treebrowserbundle" title="Enlazar permanentemente con este título">¶</a></h1>
<p>El <a class="reference external" href="https://github.com/symfony-cmf/TreeBrowserBundle#readme">TreeBrowserBundle</a> proporciona un árbol de navegación en lo alto de un repositorio <em>PHPCR</em>.</p>
<p>Este paquete consta de dos partes:</p>
<blockquote>
<div><ul class="simple">
<li>Árbol de navegación genérico con una <tt class="docutils literal"><span class="pre">TreeInterface</span></tt></li>
<li>Implementación del árbol <em>PHPCR</em> e <em>IGU</em> para un navegador <em>PHPCR</em></li>
</ul>
</div></blockquote>
<div class="section" id="dependencias">
<span id="index-0"></span><h2>Dependencias<a class="headerlink" href="#dependencias" title="Enlazar permanentemente con este título">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://github.com/FriendsOfSymfony/FOSJsRoutingBundle">FOSJsRoutingBundle</a></li>
<li>Instala <em>jQuery</em>. <a class="reference external" href="https://github.com/sonata-project/SonatajQueryBundle">SonatajQueryBundle</a> fuertemente recomendado.</li>
</ul>
</div>
<div class="section" id="configurando">
<h2>Configurando<a class="headerlink" href="#configurando" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La clave de configuración para este paquete es <tt class="docutils literal"><span class="pre">symfony_cmf_tree_browser</span></tt></p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">symfony_cmf_tree_browser</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">session</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">default</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="enrutado">
<h2>Enrutado<a class="headerlink" href="#enrutado" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El paquete creará las rutas para cada implementación del árbol encontrado. Para activar esas rutas necesitas incluir lo siguiente en tu configuración de enrutado:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/routing.yml</span>
<span class="l-Scalar-Plain">symfony_cmf_tree</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">resource</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">.</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="s">&#39;symfony_cmf_tree&#39;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="usando">
<h2>Usando<a class="headerlink" href="#usando" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Tienes <tt class="file docutils literal"><span class="pre">select.js</span></tt> e <tt class="file docutils literal"><span class="pre">init.js</span></tt> los cuáles son una envoltura para construir un árbol <em>jQuery</em>. Úsalos con <tt class="docutils literal"><span class="pre">SelectTree.initTree</span></tt> <tt class="docutils literal"><span class="pre">resp.</span></tt> <tt class="docutils literal"><span class="pre">AdminTree.initTree</span></tt></p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">SelectTree</span></tt> en <tt class="file docutils literal"><span class="pre">select.js</span></tt> es un árbol para seleccionar un nodo para poner el <tt class="docutils literal"><span class="pre">id</span></tt> a un campo</li>
<li><tt class="docutils literal"><span class="pre">AdminTree</span></tt> en <tt class="file docutils literal"><span class="pre">init.js</span></tt> es para crear un árbol, mover y editar nodos</li>
</ul>
</div></blockquote>
<p>Ambos tienen las siguientes opciones al crearlos:</p>
<blockquote>
<div><ul class="simple">
<li>config.selector: selector <em>jQuery</em> dónde enganchar en el árbol <em>js</em></li>
<li>config.rootNode: id para el nodo raíz de tu árbol, predefinido a «/»</li>
<li>config.selected: id del nodo seleccionado</li>
<li>config.ajax.children_url: <em>URL</em> al controlador que proporciona los hijos de un nodo</li>
<li>config.routing_defaults: arreglo para parámetros de ruta (tal como <tt class="docutils literal"><span class="pre">_locale</span></tt>, etc.)</li>
<li>config.path.expanded: ruta de árbol donde el árbol se tendría que expandir al momento</li>
<li>config.path.preloaded: árbol de rutas en el cual se debería precargar el nodo para acelerar la experiencia del usuario</li>
</ul>
</div></blockquote>
<div class="section" id="solo-select-js">
<h3>Solo <tt class="file docutils literal"><span class="pre">select.js</span></tt><a class="headerlink" href="#solo-select-js" title="Enlazar permanentemente con este título">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>config.output: Dónde escribir el <tt class="docutils literal"><span class="pre">id</span></tt> del nodo seleccionado</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="solo-init-js">
<h3>Solo <tt class="file docutils literal"><span class="pre">init.js</span></tt><a class="headerlink" href="#solo-init-js" title="Enlazar permanentemente con este título">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>config.labels: arreglo conteniendo la traducción para las etiquetas del contexto menú (claves <tt class="docutils literal"><span class="pre">'createItem'</span></tt> y <tt class="docutils literal"><span class="pre">'deleteItem'</span></tt>)</li>
<li>config.ajax.move_url: <em>URL</em> al controlador para mover un hijo (es decir, asignarle un nuevo nodo padre)</li>
<li>config.ajax.reorder_url: <em>URL</em> al controlador para reorganizar hermanos</li>
<li>config.types: arreglo indexado con los tipos de nodo conteniendo información sobre <tt class="docutils literal"><span class="pre">valid_children</span></tt>, iconos y rutas disponibles, utilizados para crear el contexto del menú y para comprobación durante las operaciones de movimiento.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="ejemplos">
<h2>Ejemplos<a class="headerlink" href="#ejemplos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Ve en las plantillas del paquete de administración de <tt class="docutils literal"><span class="pre">Sonata</span></tt> los ejemplos sobre cómo construir el árbol:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/sonata-project/SonataDoctrinePhpcrAdminBundle/blob/master/Resources/views/Tree/tree.html.twig">init.js</a></li>
<li><a class="reference external" href="https://github.com/sonata-project/SonataDoctrinePhpcrAdminBundle/blob/master/Resources/views/Form/form_admin_fields.html.twig">select.js</a> (busca <tt class="docutils literal"><span class="pre">doctrine_phpcr_type_tree_model_widget</span></tt>)</li>
</ul>
<p>En el mismo paquete el <a class="reference external" href="https://github.com/sonata-project/SonataDoctrinePhpcrAdminBundle/blob/master/Tree/PhpcrOdmTree.php">PhpcrOdmTree</a> implementa la interfaz de árbol y da un ejemplo sobre cómo implementar los métodos.</p>
<p>Aquí tienes algunos consejos comunes sobre la utilización del <tt class="docutils literal"><span class="pre">TreeBrowser</span></tt>:</p>
<div class="section" id="define-tree-elements">
<h3>Define tree elements<a class="headerlink" href="#define-tree-elements" title="Enlazar permanentemente con este título">¶</a></h3>
<p>The first step, is to define all the elements allowed in the tree and their children.
Have a look at the <a class="reference external" href="https://github.com/symfony-cmf/cmf-sandbox/blob/master/app/config/config.yml">cmf-sandbox configuration</a>, the section document_tree in sonata_doctrine_phpcr_admin.</p>
<p>This configuration is set for all your application trees regardless their type (admin or select).</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">sonata_doctrine_phpcr_admin</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">document_tree_defaults</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">locale</span><span class="p-Indicator">]</span>
    <span class="l-Scalar-Plain">document_tree</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Doctrine\PHPCR\Odm\Document\Generic</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">valid_children</span><span class="p-Indicator">:</span>
                <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">all</span>
        <span class="l-Scalar-Plain">Symfony\Cmf\Bundle\ContentBundle\Document\MultilangStaticContent</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">valid_children</span><span class="p-Indicator">:</span>
                <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Symfony\Cmf\Bundle\BlockBundle\Document\SimpleBlock</span>
                <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Symfony\Cmf\Bundle\BlockBundle\Document\ContainerBlock</span>
                <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Symfony\Cmf\Bundle\BlockBundle\Document\ReferenceBlock</span>
                <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Symfony\Cmf\Bundle\BlockBundle\Document\ActionBlock</span>
        <span class="l-Scalar-Plain">Symfony\Cmf\Bundle\BlockBundle\Document\ReferenceBlock</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">valid_children</span><span class="p-Indicator">:</span> <span class="p-Indicator">[]</span>
        <span class="l-Scalar-Plain">...</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="how-to-add-an-admin-tree-to-your-page">
<h3>How to add an admin tree to your page<a class="headerlink" href="#how-to-add-an-admin-tree-to-your-page" title="Enlazar permanentemente con este título">¶</a></h3>
<p>This can be done either in an action template or in a custom block.</p>
<p>You have to specify the tree root and the selected item, this allows you to have different type of content in your tree.</p>
<p>In this example, we will have the menu elements :</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="highlight-jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">render</span> <span class="s1">&#39;sonata.admin.doctrine_phpcr.tree_controller:treeAction&#39;</span> <span class="k">with</span> <span class="o">{</span> <span class="s1">&#39;root&#39;</span><span class="o">:</span> <span class="nv">websiteId</span><span class="o">~</span><span class="s2">&quot;/menu&quot;</span><span class="o">,</span> <span class="s1">&#39;selected&#39;</span><span class="o">:</span> <span class="nv">menuNodeId</span> <span class="o">}</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="how-to-customize-the-tree-behaviour">
<h3>How to customize the tree behaviour<a class="headerlink" href="#how-to-customize-the-tree-behaviour" title="Enlazar permanentemente con este título">¶</a></h3>
<p>The TreeBrowserBundle is based on <a class="reference external" href="http://www.jstree.com/documentation">jsTree</a>. jsTree works with events, dispatched everytime the user does an action.</p>
<p>A simple way to customize the tree behavior is to bind your actions to those events.</p>
<p>If you have a look at init.js and select.js, you will notice that actions are already bound to some of the tree events. If the default behavior is not
what you need, JQuery provide the unbind function to solve the problem.</p>
<p>Here is a simple way to remove the context menu from the admin tree :</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="highlight-jinja"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">render</span> <span class="s1">&#39;sonata.admin.doctrine_phpcr.tree_controller:treeAction&#39;</span> <span class="k">with</span> <span class="o">{</span> <span class="s1">&#39;root&#39;</span><span class="o">:</span> <span class="nv">websiteId</span><span class="o">~</span><span class="s2">&quot;/menu&quot;</span><span class="o">,</span> <span class="s1">&#39;selected&#39;</span><span class="o">:</span> <span class="nv">menuNodeId</span> <span class="o">}</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;script type=&quot;text/javascript&quot;&gt;</span>
<span class="x">    $(document).ready(function() {</span>
<span class="x">        $(&#39;#tree&#39;).bind(&quot;before.jstree&quot;, function (e, data) {</span>
<span class="x">            if (data.plugin === &quot;contextmenu&quot;) {</span>
<span class="x">                e.stopImmediatePropagation();</span>
<span class="x">                    return false;</span>
<span class="x">            }</span>
<span class="x">        });</span>
<span class="x">    });</span>
<span class="x">&lt;/script&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>By default, the item selection open the edit route of the admin class of the element. This action is bind to the &#8220;select_node.jstree&#8221;.</p>
<p>If you want to remove it, you just need to call the unbind function on this event :</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="highlight-jinja"><div class="highlight"><pre><span class="x">&lt;script type=&quot;text/javascript&quot;&gt;</span>
<span class="x">    $(document).ready(function() {</span>
<span class="x">        $(&#39;#tree&#39;).unbind(&#39;select_node.jstree&#39;);</span>
<span class="x">    });</span>
<span class="x">&lt;/script&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Then you can bind it on another action.</p>
<p>For example, if your want to open a custom action :</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="highlight-jinja"><pre>$('#tree').bind("select_node.jstree", function (event, data) {
    if ((data.rslt.obj.attr("rel") == 'Symfony_Cmf_Bundle_MenuBundle_Document_MenuNode'
        || data.rslt.obj.attr("rel") == 'Symfony_Cmf_Bundle_MenuBundle_Document_MultilangMenuNode')
        &amp;&amp; data.rslt.obj.attr("id") != '{{ menuNodeId }}'
    ) {
        var routing_defaults = {'locale': '{{ locale }}', '_locale': '{{ _locale }}'};
        routing_defaults["id"] = data.rslt.obj.attr("url_safe_id");
        window.location = Routing.generate('presta_cms_page_edit', routing_defaults);
    }
});</pre>
</div>
</li>
</ul>
</div>
<p>Don&#8217;t forget to add your custom route to the fos_js_routing.routes_to_expose configuration :</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">fos_js_routing</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">routes_to_expose</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">symfony_cmf_tree_browser.phpcr_children</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">symfony_cmf_tree_browser.phpcr_move</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sonata.admin.doctrine_phpcr.phpcrodm_children</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sonata.admin.doctrine_phpcr.phpcrodm_move</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">presta_cms_page_edit</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <a href="https://github.com/symfony/symfony-standard"><img style="position: fixed; top: 0; right: 0; border: 0;" src="http://gitnacho.github.com/tnp/img/comun/bifurcame.png" alt="Bifúrcame en GitHub" /></a>
  
  <div style="width:740px;margin:10px auto;">
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../cookbook/phpcr-odm-custom-documentclass-mapper.html" title="Usando una clase documento personalizada asociada con PHPCR-ODM"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="doctrine_phpcr_admin.html" title="SonataDoctrinePhpcrAdminBundle"
             >anterior</a> |</li>
        <li><a href="../../index.html">en Español</a> &raquo;</li>
          <li><a href="../index.html" >Documentación del <tt class="docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal docutils literal"><span class="pre">CMF</span></tt> de <em>Symfony</em></a> &raquo;</li> 
      </ul>
    </div>
  </div>


   <div style="width: 740px; margin: 0 auto;">
     <div id="disqus_thread"></div>
     
    <div class="footer">
        &copy; Copyright 2011-2013, Traducido por Nacho Pacheco.
      Actualizado por última vez en Mar 19, 2013.
      Creado con <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
   </div>
   <script type="text/javascript">
    var disqus_shortname = 'documentos-mx';
    var disqus_developer = 1;
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
   </script>
   <noscript>
     Por favor activa JavaScript para ver los <a href="http://disqus.com/?ref_noscript">comentarios accionados por Disqus.</a>
   </noscript>

  </body>
</html>